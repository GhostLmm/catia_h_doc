<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GeometricObjects/PublicInterfaces/CATMathNurbsMultiForm.h</title>
    <style>
        body {
            font-family: 'Consolas', 'Monaco', monospace;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .header {
            background-color: #2c3e50;
            color: white;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        .navigation {
            display: flex;
            justify-content: space-between;
            margin: 15px 0;
            padding: 10px;
            background-color: #ecf0f1;
            border-radius: 5px;
        }
        .navigation a {
            color: #2980b9;
            text-decoration: none;
            padding: 5px 10px;
            background-color: white;
            border-radius: 3px;
            border: 1px solid #bdc3c7;
        }
        .navigation a:hover {
            background-color: #3498db;
            color: white;
        }
        .content {
            background-color: white;
            padding: 20px;
            border-radius: 5px;
            border: 1px solid #bdc3c7;
            white-space: pre-wrap;
            font-size: 14px;
            line-height: 1.4;
            overflow-x: auto;
        }
        .back-to-index {
            text-align: center;
            margin: 15px 0;
        }
        .back-to-index a {
            color: #27ae60;
            text-decoration: none;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>GeometricObjects/PublicInterfaces/CATMathNurbsMultiForm.h</h1>
    </div>
    
    <div class="navigation">
        <div><a href="CATMacroPoint.html">‚Üê ‰∏ä‰∏ÄÈ°µ: CATMacroPoint.h</a></div>
        <div><a href="CATMathSideEval.html">‰∏ã‰∏ÄÈ°µ: CATMathSideEval.h ‚Üí</a></div>
    </div>
    
    <div class="back-to-index">
        <a href="index.html">üìÅ ËøîÂõûÁõÆÂΩï</a>
    </div>
    
    <div class="content">#ifndef CATMathNurbsMultiForm_H
#define CATMathNurbsMultiForm_H
/** @CAA2Required */
//**********************************************************************
//* DON T DIRECTLY INCLUDE THIS HEADER IN YOUR APPLICATION CODE. IT IS *
//* REQUIRED TO BUILD CAA APPLICATIONS BUT IT MAY DISAPEAR AT ANY TIME *
//**********************************************************************

// COPYRIGHT DASSAULT SYSTEMES 1997
//==========================================================================
//
// CATMathNurbsMultiForm:
//
// Mathematical class of monoparametric NURBS.
// The CATMathNurbsMultiForm is a set of forms (each form being equivalent to
// a monoparametric NURBS) with the same knot vector.
// It can be used for free NURBS (Dimension = 3) or for NURBS on a non specified
// support (Dimension = 2).
// This class allows working on non C2 NURBS because of its mathematical
// definition. It can also be regarded as an advanced NURBS library.
//
// Constructors  :     - Basic Constructors
//                     - Constructor by Concatenation of NurbsMultiForms
//                     - Constructor  with   NurbsCurve(s)               (see CATMathNurbsMultiFormConstructor_07)
//                     - Constructor  with a NurbsSurface                (see CATMathNurbsMultiFormConstructor_13)
//                     - Constructor  with a NurbsBipar                  (see CATMathNurbsMultiFormConstructor_11)
//                     - Constructor  with   points and derivatives      (see CATMathNurbsMultiFormConstructor_03)
//
// Basic methods :     - GetDimension
//                     - GetKnotVector
//                     - GetNumberOfCPs
//                     - GetIndexOffset
//                     - GetNumberOfCPsByForm
//                     - GetNumberOfForms
//                     - GetOneControlPoint
//                     - GetOneWeight
//                     - GetOneForm
//                     - IsRational
//                     - IsClosed
//                     - SetOneControlPoint
//                     - SetOneWeight
//                     - GetPolygonLength
//                     - SetLimits
//                     - GetLimits
//                     - GetEquations
//                     - GetMultiEquations
//                     - GetGlobalEquation
//
// Evaluators :        - Eval
//
// Advanced methods :  - ActiveSplit
//                     - DecreaseDegree
//                     - Explode
//                     - KnotInsertion
//                     - IncreaseDegree
//                     - Invert
//                     - NaturalKnotRemoval
//                     - ChangeParametricSpace
//                     - RemoveWeights
//                     - SetWeights
//                     _ ChangeKnotMultiplicities (protected)
//                     _ RemovePeriodicity

//
// Geometric methods : - ConvertToNthNurbsCurve
//                     - ConvertToNurbsCurve
//                     - ConvertToPNurbs
//                     - SetGlobalNurbsCurve
//                     - SetGlobalPNurbs
//
// Debug methods :     - Dump
//
//==========================================================================
// ??/??/?? DHN,
//          NDN,
//          DR  Creation
// ??/07/06 DR  Changements de signatures R18 pour CATTolerance
// 22/05/07 NLD _TolObject est defini hors du bloc specifique R18
//              SetTolerance()
//              On supprime l&#x27;argument iTolObject du copy constructeur
// 17/03/08 NLD On evite les methodes inline du type {instruction} dans lesquelles le debugger ne rentre pas
// 27/03/12 NLD Ajout Init(),
//              InitWithSetOfPointsND(), InitByHermiteInterpolation(), InitWithCurve(),
//              InitWithSetOfPoints(), InitWithBipar(), InitWithSurface()
// 06/04/12 NLD Ajout numrotation stable des constructeurs
// 12/04/12 NLD Ajout GetSoftwareConfiguration()
//              _TolObject et _Config ne sont plus publics
// 16/04/12 NLD Ajout SetSoftwareConfiguration()
//              afin de faciliter les cas - rares mais embetants - de cration par le constructeur
//              par dfaut d&#x27;un objet ensuite recopi par copy constructor, et dont la configuration
//              est transmise, et la compatibilit avec le systeme de detection des configurations
//              absentes, on rend publique cette mthode
// 05/11/12 NLD Ajout CATMathNurbsMultiFormConstructor_15 pour perfos
// 14/05/14 NLD Ajout Clear()
//              Smart indent
//              Homogeneisation des notations
// 20/07/15 NLD Ajout CATMathNurbsMultiFormDumper
//==========================================================================
#include &quot;CATIACGMLevel.h&quot;
#include &quot;YP00IMPL.h&quot;

#include &quot;CATDataType.h&quot;
#include &quot;CATTolerance.h&quot;

#include &quot;CATMathPoint.h&quot;
#include &quot;CATMathSetOfPoints.h&quot;
#include &quot;CATMathSetOfVectors.h&quot;

#include &quot;CATKnotVector.h&quot;

#include &quot;CATCGMVirtual.h&quot;

#include &quot;CATCurve.h&quot;
#include &quot;CATNurbsCurve.h&quot;
#include &quot;CATPNurbs.h&quot;
#include &quot;CATNurbsSurface.h&quot;
#include &quot;CATSurLimits.h&quot;
#include &quot;CATCrvLimits.h&quot;
#include &quot;CATGeoFactory.h&quot;

#include &quot;CATParameterizationOption.h&quot;

class CATMathNurbsBipar;
class CATMathPolynomX;
class CATMathFunctionX;
class CATMathNxNBandSymMatrix;
class CATMathMxNMatrix;
class CATSoftwareConfiguration;
class CATMathNurbsMultiFormSpecialImpl;

//-----------------------------------------------------------------------------
class ExportedByYP00IMPL CATMathNurbsMultiForm : public CATCGMVirtual
{
  friend class CATMathNurbsMultiFormSpecialImpl;
  friend class CATMathNurbsMultiFormDumper;

  public :

    //
    //-------------------  Basic Constructors -------------------
    //
    //  default constructor
    //               (Nota: CATMathNurbsMultiFormConstructor_* is a stable numbering in implementation file,
    //                NEVER to be changed; may also be useful under XRef tools; NLD060412)
    //
    //                                                               CATMathNurbsMultiFormConstructor_01
    //  default constructor
    //  (call should be replaced by a constructor with full data definition or at least by CATMathNurbsMultiFormConstructor_15) 
    CATMathNurbsMultiForm(
                         );

    //  enhanced (and fake) default constructor
    //                                                               CATMathNurbsMultiFormConstructor_15
    CATMathNurbsMultiForm(      CATSoftwareConfiguration *  iConfig            ,
                          const CATTolerance              &amp; iTolObject         
                         );

    //  Constructor with attributes
    //  -&gt; One set of points by form. Note that if we want to create a &quot;P&quot;
    //     multiform, the dimension is set to 2 but the CATMathSetOfPoints in
    //     input are 3D (the third coordinate is set to 0.)
    //  -&gt; If each form has n control points, the weights array contains the n
    //     weights of the first form, then the n weights of the second form,
    //     and so on...
    //Do not use
    //                                                               CATMathNurbsMultiFormConstructor_09
    CATMathNurbsMultiForm(      CATSoftwareConfiguration *  iConfig            ,
                          const CATMathSetOfPoints      **  iSetOfPoints       ,
                          const CATLONG32                 &amp; iIsRational        ,
                          const CATKnotVector            *  iKnotVector        ,
                          const CATLONG32                 &amp; iDimension         ,
                          const CATLONG32                 &amp; iNumberOfForms     ,
                          const double                   *  iWeights           = NULL ,
                          const CATTolerance              &amp; iTolObject         = CATGetDefaultTolerance()
                         );

    //  constructor from a CATMathNurbsBipar
    //  iDir=1 : direction U
    //  iDir=2 : direction V
    //                                                               CATMathNurbsMultiFormConstructor_11
    CATMathNurbsMultiForm(      CATSoftwareConfiguration *  iConfig            ,
                          const CATMathNurbsBipar        *  iMathNurbsBipar    ,
                          const CATLONG32                 &amp; iDir               ,
                          const CATTolerance              &amp; iTolObject         = CATGetDefaultTolerance()
                          );
    //  destructor
    virtual ~CATMathNurbsMultiForm();

    // Operator &#x27;=&#x27; (overloaded) 
    virtual CATMathNurbsMultiForm&amp; operator = (const CATMathNurbsMultiForm &amp;iNurbsMultiForm);

    //
    //------------------- Advanced Constructors -------------------
    //
    //  Constructor from points and their derivatives.
    //  Each point is an arc limit of the multiform.
    //  Works only for degree 3 and 5. In case of degree 3, iSndDer
    //  must be a NULL pointer.
    //  OptimiseContinuity : 0 means results will have a C0 nodal vector (but C2 mathematicaly and faster).
    //                                                               CATMathNurbsMultiFormConstructor_03
    CATMathNurbsMultiForm(      CATSoftwareConfiguration *  iConfig            ,
                          const CATKnotVector            *  iKnotVector        ,
                          const CATMathSetOfPointsND     *  iPoints            ,
                          const CATMathSetOfPointsND     *  iFstDer            ,
                          const CATMathSetOfPointsND     *  iSndDer            = NULL,
                                CATLONG32                   OptimiseContinuity = 1,
                          const CATTolerance              &amp; iTolObject         = CATGetDefaultTolerance()
                         );

    //  Hermite Interpolation.
    //  Constructor from points and eventually derivatives at the two
    //  extremities (if CATMathSetOfPointsNDTwoTangents).
    //  Each point is an arc limit of the multiform.
    //  The result is a cubic multiform. The dimension will be 3 and
    //  the number of forms will be the dimension of the set of points
    //  divided by 3.
    //  It is possible to impose a parameter for each point of the set.
    //                                                               CATMathNurbsMultiFormConstructor_05
    CATMathNurbsMultiForm(      CATSoftwareConfiguration *  iConfig            ,
                          const CATMathSetOfPointsND     *  iPoints            ,
                          const double                   *  iParameters        = NULL,
                          const CATTolerance              &amp; iTolObject         = CATGetDefaultTolerance()
                         );


    //  constructor from a curve and its limits
    //                                                               CATMathNurbsMultiFormConstructor_07
    CATMathNurbsMultiForm(      CATSoftwareConfiguration *  iConfig            ,
                          const CATCurve                 *  iCurve             ,
                          const CATCrvLimits             *  iCrvLim            = NULL,
                          const CATTolerance              &amp; iTolObject         = CATGetDefaultTolerance()
                         );

    //  constructor from a CATNurbsSurface and its limits 
    //  iDir=1 : direction U
    //  iDir=2 : direction V
    //                                                               CATMathNurbsMultiFormConstructor_13
    CATMathNurbsMultiForm(      CATSoftwareConfiguration *  iConfig            ,
                          const CATLONG32                 &amp; iDir               ,
                          const CATNurbsSurface          *  iSurface           ,
                          const CATSurLimits             *  iSurLimits         = NULL,
                          const CATTolerance              &amp; iTolObject         = CATGetDefaultTolerance()
                         );

    //
    //-------------------  Deprecated Constructors (DO NOT USE) -------------------
    //
    // Do not use (use constructor CATMathNurbsMultiFormConstructor_09 with CATSoftwareConfiguration)
    //                                                               CATMathNurbsMultiFormConstructor_08
    CATMathNurbsMultiForm(const CATMathSetOfPoints      **  iSetOfPoints       ,
                          const CATLONG32                 &amp; iIsRational        ,
                          const CATKnotVector            *  iKnotVector        ,
                          const CATLONG32                 &amp; iDimension         ,
                          const CATLONG32                 &amp; iNumberOfForms     ,
                          const double                   *  iWeights           = NULL,
                          const CATTolerance              &amp; iTolObject         = CATGetDefaultTolerance()
                          )  ;

    // Do not use (use constructor CATMathNurbsMultiFormConstructor_11 with CATSoftwareConfiguration)
    //                                                               CATMathNurbsMultiFormConstructor_10
    CATMathNurbsMultiForm(const CATMathNurbsBipar        *  iMathNurbsBipar    ,
                          const CATLONG32                 &amp; iDir               ,
                          const CATTolerance              &amp; iTolObject         = CATGetDefaultTolerance()

                          );

    // Do not use
    //                                                               CATMathNurbsMultiFormConstructor_14
    CATMathNurbsMultiForm(const CATMathNurbsMultiForm     &amp; iMathNurbsMultiForm
                         );

    // Do not use (use constructor CATMathNurbsMultiFormConstructor_03 with CATSoftwareConfiguration)
    //
    //                                                               CATMathNurbsMultiFormConstructor_02
    CATMathNurbsMultiForm(const CATKnotVector            *  iKnotVector        ,
                          const CATMathSetOfPointsND     *  iPoints            ,
                          const CATMathSetOfPointsND     *  iFstDer            ,
                          const CATMathSetOfPointsND     *  iSndDer            = NULL,
                                CATLONG32                   OptimiseContinuity = 1,
                          const CATTolerance              &amp; iTolObject         = CATGetDefaultTolerance()
                         );

    // Do not use (use constructor CATMathNurbsMultiFormConstructor_05 with CATSoftwareConfiguration)
    //                                                               CATMathNurbsMultiFormConstructor_04
    CATMathNurbsMultiForm(const CATMathSetOfPointsND     *  iPoints            ,
                          const double                   *  iParameters        = NULL,
                          const CATTolerance              &amp; iTolObject         = CATGetDefaultTolerance()
                         );


    // Do not use (use constructor CATMathNurbsMultiFormConstructor_07 with CATSoftwareConfiguration)
    //                                                               CATMathNurbsMultiFormConstructor_06
    CATMathNurbsMultiForm(const CATCurve                 *  iCurve             ,
                          const CATCrvLimits             *  iCrvLim            = NULL,
                          const CATTolerance              &amp; iTolObject         = CATGetDefaultTolerance()
                         );

    // Do not use (use constructor CATMathNurbsMultiFormConstructor_13 with CATSoftwareConfiguration)
    //                                                               CATMathNurbsMultiFormConstructor_12
    CATMathNurbsMultiForm(const CATLONG32                 &amp; iDir               ,
                          const CATNurbsSurface          *  iSurface           ,
                          const CATSurLimits             *  iSurLimits         = NULL,
                          const CATTolerance              &amp; iTolObject         = CATGetDefaultTolerance()
                         );

    //
    //-------------------  Basic Methods ------------------- 
    //

    //
    //-------------- Evaluators ------------------- 
    //
    virtual void Eval                                          (const double                    &amp; iLocalParam        ,
                                                                const CATLONG32                 &amp; iArcRank           ,
                                                                const CATCrvEvalCommand         &amp; iCommand           ,
                                                                      CATMathPoint             *  oPoint             ,
                                                                      CATMathVector            *  oFirstDeriv        = NULL,
                                                                      CATMathVector            *  oSecondDeriv       = NULL) const;

    virtual void Eval                                          (const double                    &amp; iLocalParam        ,
                                                                const CATLONG32                 &amp; iArcRank           ,
                                                                const CATLONG32                 &amp; iFormRank          ,
                                                                const CATCrvEvalCommand         &amp; iCommand           ,
                                                                      CATMathPoint             *  oPoint             ,
                                                                      CATMathVector            *  oFirstDeriv        = NULL,
                                                                      CATMathVector            *  oSecondDeriv       = NULL) const;

    virtual void Eval                                          (const double                    &amp; iLocalParam        ,
                                                                const CATLONG32                 &amp; iArcRank           ,
                                                                const CATCrvEvalCommand         &amp; iCommand           ,
                                                                      double                   *  oPoint             ,
                                                                      double                   *  oFirstDeriv        = NULL,
                                                                      double                   *  oSecondDeriv       = NULL) const;

    virtual void Eval                                          (const double                    &amp; iLocalParam        ,
                                                                const CATLONG32                 &amp; iArcRank           ,
                                                                const CATLONG32                 &amp; iFormRank          ,
                                                                const CATCrvEvalCommand         &amp; iCommand           ,
                                                                      double                   *  oPoint             ,
                                                                      double                   *  oFirstDeriv        = NULL,
                                                                      double                   *  oSecondDeriv       = NULL) const;

    virtual void                       EvalND                  (const double                    &amp; iLocalParam        ,
                                                                const CATLONG32                 &amp; iArcRank           ,
                                                                const CATCrvEvalCommand         &amp; iCommand           ,
                                                                      double                   *  ioPoint            ,
                                                                      double                   *  ioFirstDeriv       = NULL,
                                                                      double                   *  ioSecondDeriv      = NULL) const;
//==========================================================================
// GetGlobal equation  for one Form (0&lt;=iFormIndex&lt;_NumberOfForms)
//
//===================================================================
    virtual void                       GetGlobalEquation        (const CATLONG32                  iFormIndex         ,
                                                                       CATMathFunctionX        *&amp; oFx                ,
                                                                       CATMathFunctionX        *&amp; oFy                ,
                                                                       CATMathFunctionX        *&amp; oFz                )       const;

// To get the equations of the MultiForm for one form (0 &lt;= iNbForm &lt;_NumberOfForms)
    virtual void                       GetEquations             (      CATLONG32                  iFormIndex         ,
                                                                       CATMathPolynomX        **  Fx                 ,
                                                                       CATMathPolynomX        **  Fy                 ,
                                                                       CATMathPolynomX        **  Fz                 ,
                                                                       CATMathPolynomX        **  Fw                 = NULL) const;

// To get the equations of the MultiForm for all the form.
// To use this method for a for a CATFrFMultiform Multi:
//    1/ CATLONG32 Nbarcs = (Multi.GetKnotVector())-&gt;GetNumberOfArcs();
//    2/ CATLONG32 NumberOfForms = (Multi.GetNumberOfForms())
//    3/ For each CATMathPolynomX **Fx,....,**Fw ,
//       Fx(yz or w) = new CATMathPolynomX *[NumberOfForms*NbArcs];
//    Then : Multi.GetMultiEquations (Fx, Fy, Fz, Fw);
//    gives in output NumberOfForms*Nbarcs CATMathPolynomX as follows:
//
//    Fx[0],...........,Fx[Nbarcs-1],Fx[Nbarcs],....Fx[Nbarcs +Nbarcs-1],
//    &lt;----------------------------&gt; &lt;----------------------------------&gt;
//            First Form                     Second Form
//    ....................................................................
//    Fx[Nbarcs*(NumberOfForm-1)],.....,Fx[Nbarcs*NumberOfForm-1)]
//    &lt;------------------------------------------------------------&gt;
//                          Last Form

    virtual void                       GetMultiEquations        (      CATMathPolynomX        **  Fx                 ,
                                                                       CATMathPolynomX        **  Fy                 ,
                                                                       CATMathPolynomX        **  Fz                 ,
                                                                       CATMathPolynomX        **  Fw                 = NULL) const;

    // Compute the length of the polygon made of the control points
    // (eventualy between two global parameters)
    virtual double                     GetPolygonLength         (                                                    )       const;

    virtual double                     Get3DPolygonLength       (      double                     Start              ,
                                                                       double                     End                ,
                                                                       CATSurface              *  Support            = NULL) const;

    // Is the MultiForm closed (regarding to the given tolerance) ?
    virtual CATLONG32                  IsClosed                 (const double                   &amp; iTolerance         )       const;
    //
    //------------------- Data Access Methods -------------------
            CATSoftwareConfiguration * GetSoftwareConfiguration ()                                                           const
      {
       return _Config;
      };
    //
    // Is the MultiForm rational ?  // 0 -&gt; no , 1 -&gt; yes
    virtual CATLONG32                  IsRational               ()                                                           const
      {
       return _IsRational;
      };

    // Get the dimension of the MultiForm : 2 for  P-MultiForm
    //                                      3 for 3D-MultiForm
    virtual CATLONG32                  GetDimension             ()                                                           const
      {
       return _Dimension;
      };

    // Read the number of control points
    virtual CATLONG32                  GetNumberOfCPs           ()                                                           const
      {
       return (_NumberOfForms*(_KnotVector-&gt;GetNumberOfControlPoints()));
      };

    // Read the number of control points per form
    virtual CATLONG32                  GetNumberOfCPsByForm     ()                                                           const
      {
       return (_KnotVector-&gt;GetNumberOfControlPoints());
      };

    // Read the number of forms
    virtual CATLONG32                  GetNumberOfForms         ()                                                           const
      {
       return _NumberOfForms;
      };

    // ----- Read one form  ----------
    // The result is a multiform with only one form.
    virtual CATMathNurbsMultiForm    * GetOneForm               (      CATLONG32                  iFormIndex         )       const;

    // Read the control points
    virtual CATMathPoint             * GetControlPoints         ()                                                           const
      {
       return _tabOfCPs;
      };
  
    virtual CATMathPoint               GetOneControlPoint       (      CATLONG32                  iRankOfPoint       ,
                                                                       CATLONG32                  iRankOfForm        )       const
      {
       return _tabOfCPs[iRankOfForm - 1 + _NumberOfForms*(iRankOfPoint-1)];
      };

    // Read the knot vector
    virtual CATKnotVector            * GetKnotVector            ()                                                           const
      {
       return _KnotVector;
      };
  
    virtual CATLONG32                  GetIndexOffset           ()                                                           const
      {
       return _Offset;
      };

    // Read the weights (if the multiform is rational)
    virtual double                   * GetWeights               ()                                                           const
      {
       double * Weights = NULL;
       if (_IsRational)
          Weights = _Weights;
       return Weights;
      };

    virtual double                     GetOneWeight             (      CATLONG32                   iRankOfPoint      ,
                                                                       CATLONG32                   iRankOfForm       )       const
      {
       double Weight = 0.0;
       if (_IsRational)
           Weight = _Weights[iRankOfForm - 1 + _NumberOfForms*(iRankOfPoint-1)];
       return Weight;
      };

    virtual void                       GetLimits                (      double                    &amp; oStart            ,
                                                                       double                    &amp; oEnd              )       const
      {
       oStart = oEnd = 0.0;
       if (_IsLimited)
         {
          oStart = _Start;
          oEnd = _End;
         }
       else
         {
          const double * Knots = NULL;
          _KnotVector-&gt;GetKnots(Knots);
          CATLONG32 NbKnots = _KnotVector-&gt;GetNumberOfKnots();
          if (Knots)
            {
             oStart = Knots[0];
             oEnd   = Knots[NbKnots-1];
            }
         }
      };

    virtual CATLONG32                  IsLimited                ()                                                           const
      {
       return _IsLimited;
      };

    //
    //-------------- Data Modification Methods -------------------
    //
    //  Set : modification of an existing CATMathNurbsMultiForm
    //  The arrays of Control Points and Weights have to be stored
    //  in this way :
    //  iPoints[0] = Form[0]ControlPoint[0],
    //  iPoints[1] = Form[1]ControlPoint[0],...,
    //  iPoints[i+j*iNumberOfForms] = Form[i]ControlPoint[j] , ...

    virtual void                       Set                      (const CATMathPoint             *  iPoints           ,
                                                                 const CATLONG32                 &amp; iIsRational       ,
                                                                 const CATKnotVector            *  iKnotVector       ,
                                                                 const CATLONG32                 &amp; iDimension        ,
                                                                 const CATLONG32                 &amp; iNumberOfForms    ,
                                                                 const double                   *  iWeights          ,
                                                                 const CATTolerance             *  iTolObject        = &amp;CATGetDefaultTolerance()
                                                                );

    virtual void                       SetLimits                (const double                    &amp; Start             ,
                                                                 const double                    &amp; End               )
      {
       _IsLimited = 1;
       _Start     = Start;
       _End       = End;
      };
 
    virtual void                       SetIndexOffset           (const CATLONG32                 &amp; iNewOffset        )
      {
       _Offset = iNewOffset;
      };

    virtual void                       SetOneControlPoint       (const CATLONG32                 &amp; iRankOfPoint      ,
                                                                 const CATLONG32                 &amp; iRankOfForm       ,
                                                                 const CATMathPoint              &amp; pt                )
      {
       _tabOfCPs[iRankOfForm - 1 + _NumberOfForms*(iRankOfPoint-1)] = pt;
      };

    virtual void                       SetOneWeight             (const CATLONG32                 &amp; iRankOfPoint      ,
                                                                 const CATLONG32                 &amp; iRankOfForm       ,
                                                                 const double                    &amp; iWeight           )
      {
       _Weights[iRankOfForm - 1 + _NumberOfForms*(iRankOfPoint-1)] = iWeight;
      };


    //
    //------------------- Advanced Methods (NURBS Library) -------------------
    //
    // Reverse the orientation of the multiform
    virtual void                       Invert                   ();

    // Increase the degree (general case)
    virtual void                       IncreaseDegree           (const CATLONG32                 &amp; iDeltaDegree      );

    // Increase the degree (special case when current degree is 1, and only 2 knots, and not rational case)
    virtual void                       IncreaseDegreeFromOne    (      CATLONG32                   iDeltaDegree      );

    // Decrease the degree
    // WARNING : This method can lead to important deviation.
    //           ioContinuityLeft and ioContinuityLeft = 0,1,2
    // iContinuity* is the continuity you want to keep at the end.
    // Left is the beginning (in parameter), Right the end.
    // IF THERE ISN&#x27;T ENOUGH FREEDOM DEGREE, NOTHING IS DONE.
    virtual void                       DecreaseDegree           (const CATLONG32                 &amp; iDeltaDegree      ,
                                                                       CATLONG32                   iContinuityLeft   = 0,
                                                                       CATLONG32                   iContinuityRight  = 0);

    // Modify the degree
    // WARNING : if the new degree is smaller than the current degree, this
    //           method can lead to important deviation.
    // iContinuity* is the continuity you want to keep at the end.
    // Usefull only if you want to decrease the degree.
    // Left is the beginning (in parameter), Right the end.
    // IF THERE ISN&#x27;T ENOUGH FREEDOM DEGREE, NOTHING IS DONE.
    virtual void                       SetDegree                (const CATLONG32                 &amp; NewDegree         ,
                                                                       CATLONG32                   iContinuityLeft   = 0,
                                                                       CATLONG32                   iContinuityRight  = 0);

    // Remove a knot.
    // If the delta of multiplicity is equal to the multiplicity of
    // the specified knot value, this one is suppressed from the knot
    // vector.
    //
    virtual void                       NaturalKnotRemoval       (const double                    &amp; iKnotValue        ,
                                                                 const CATLONG32                 &amp; DeltaMultiplicity );

    // Insert a Knot
    // If the knot value already exists in the knot vector, its multiplicity
    // is increased until the specified multiplicity.
    // Note that the CATEpsg tolerance is used in order to test the equality
    // of two knot values.
    // if iTolKnotConfusion is specified as a positive value,
    // an error is thrown if the knot insertion introduces a arc that is
    // parametrically shorter than this tolerance.
    virtual void                       KnotInsertion            (const double                    &amp; iKnotValue        ,
                                                                 const CATLONG32                 &amp; Multiplicity      ,
                                                                       double                      iTolKnotConfusion = 0.);

    // Active Split  (break)
    // The user specifies a couple of knot values. The multiform
    // is splitted with a new parametrisation beginning at the first
    // knot value and ending at the second. The algorithm is based
    // on knot insertion.
    // if iTolKnotConfusion is specified as a positive value,
    // an error is thrown if the split introduces a arc that is
    // parametrically shorter than this tolerance.
    virtual void                       ActiveSplit              (const double                   *  iLimitsKnotValues ,
                                                                       double                      iTolKnotConfusion = 0.0);

    // Explode  (multiple break)
    // The multiform is exploded into n new multiforms, the user specifies
    // the (n-1) knot values where the original multiform is to be broken.
    // The knot values must be given in the increasing parameter order.
    // The new multiforms are returned via an array of multiforms. The algorithm
    // is based on knot insertion.
    //

    // Mise en format non periodique de la Nurbs
            void                       RemovePeriodicity        ();

    // Relimitation element geometrique equivalent
            void                       Relimit                  (      CATCurve                 *  MyNurbs           );

            CATMathNurbsMultiForm   ** Explode                  (const double                   *  iBreakKnotValues  ,
                                                                 const CATLONG32                 &amp; iNumberOfBreakKnotValues);


    // Change Parametric Space
    // This method changes the knot values of the multiform by
    // affine transformation. The form is not changed. The new knot vector
    // of the multiform will begin at the new first knot value (given as
    // an input) and end at the new last one (also given as an input).
    //
    virtual void                       ChangeParametricSpace    (const double                    &amp; iNewFirstKnotValue,
                                                                 const double                    &amp; iNewLastKnotValue );

    // RemoveWeights
    // This method removes the weigths of the multiform
    // if iCheckWeights=0, this method removes the weigths of the multiform
    // if iCheckWeights=1, this method checks if all the weights are the same
    // before removing the weigths of the multiform. If all the weights are not
    // the same this method does nothing and returns 1
    // Returns 0 if the weigths are removed.
            int                        RemoveWeights            (      int                         iCheckWeights     = 0);

    // SetWeights
    // This method adds weigths to a non rational multiform
    // For a rational multiform, this method changes the weigths
    // if iWeights=NULL the weigths are equal to 1.
            void                       SetWeights               (      double                   *  iWeights          = NULL);


    //
    //--------------- Creation or Modification of Geometry -------------------
    //
    // Create a Nurbs Curve with a MultiForm (if just one form)
    virtual CATNurbsCurve            * ConvertToNurbsCurve      (      CATGeoFactory            *                    );

    // Create a Nurbs Curve with the nth form of the MultiForm
    virtual CATNurbsCurve            * ConvertToNthNurbsCurve   (      CATGeoFactory            *                    ,
                                                                       int                         iFormIndex        );

    // Modify an existing Nurbs Curve with a MultiForm
    // By default, the parameterization of the NURBS is modified to better
    // fit internal criteria. CatKeepParameterization will keep the original
    // parametrization.
    virtual void                       SetGlobalNurbsCurve      (      CATNurbsCurve            *  MyNurbs            ,
                                                                       CATParameterizationOption   iParameterizationOption = CatAutomaticParameterization);

    // Create a PNurbs with a MultiForm
    virtual CATPNurbs             *    ConvertToPNurbs          (      CATGeoFactory            *                     ,
                                                                       CATSurface               *                     );

    // Modify an existing PNurbs with a MultiForm
    // By default, the parameterization of the NURBS is modified to better
    // fit internal criteria. CatKeepParameterization will keep the original
    // parametrization.
    virtual void                       SetGlobalPNurbs          (      CATPNurbs                *  MyNurbs            ,
                                                                       CATParameterizationOption   iParameterizationOption = CatAutomaticParameterization);

    //--------------- Internal  methods -------------------
    // Insert many Knots
    // If one of the knot values already exists in the knot vector,
    // its multiplicity increases until the specified multiplicity.
    // Note that the CATEpsg tolerance is used in order to test the equality
    // of two knot values.
    // Using the default value iTolKnotConfusion, we do not change the behaviour of this software.
    // Using it, it will consider is as the confusion tolerance with an existing knot :
    //        if there already exists a knot within this tolerance, we will throw an error.
    // If iTolKnotConfusion is specified as a positive value,
    // an error is thrown if the knot insertions introduces a arc that is
    // parametrically shorter than this tolerance.
    //
    virtual void                       MultipleKnotInsertion    (const double                   *  iKnotValues        ,
                                                                 const CATLONG32                *  iMultiplicities    ,
                                                                 const CATLONG32                 &amp; iNbOfInsertions    ,
                                                                 double                            iTolKnotConfusion  = 0.0);

    //--------------- Debug methods -------------------
    // 
    // dump pour debug
    virtual void                       Dump                     ();


    // Method that checks if a bipare is rational or not.
    // It returns 0 if no error has occured during the analysis.
    // The diagnostic equals :
    //    - 0 if the nurbs is not built as rational (_IsRational==0)
    //    - a positive value otherwise :
    //            1 if the weights are all the same
    //            2 if the weights are the same in U (not rational in u)
    //            3 if the weights are the same in V (not rational in v)
    //            4 if the weights are different in both directions
            CATLONG32                  CheckRationality         (      CATLONG32                 &amp; diagnostic         );

    // methode qui permet d&#x27;avoir le bloc d&#x27;encombrement d&#x27;un arc de multiforme
    // rend 0 si le traitement se passe correctement
    // iNumPatchU commence a 1
    // iTolerance est le gras a ajouter a la boite d&#x27;encombrement
    // l&#x27;argument makeMeasureOnC0Geom permet s&#x27;il est value a 1, d&#x27;inserer
    // des noeuds C0 sur la MF et d&#x27;avoir ainsi une mesure plus precise du
    // bloc d&#x27;encombrement (traitement plus cher en CPU si MultiForm non C0, duplication de la MultiForm et
    // insertion de noeud).
    //  Demander une evolution si utilisation massive (centraliser ce service dans une
    //  classe afin d&#x27;optimiser les perfos (KnotInsersions massives))
    virtual CATLONG32                  ArcBox                   (      CATLONG32                   iNumArc             ,
                                                                       double                      iTolerance          ,
                                                                       CATMathBox                &amp; box                 ,
                                                                       CATLONG32                   makeMeasureOnC0Geom = 0);

    // Calcul de la boite d&#x27;encombrement sur l&#x27;ensemble de la multiforme.
    // La courbe est forcement dans le volume d&#x27;encombrement des points de controle
    virtual CATLONG32                  ComputeMFMaxBox          (      double                      iTolerance          ,
                                                                       CATMathBox                &amp; box                 );
    //Ajout MNA
    virtual void                ChangeKnotVectorAndReturnMatrix (const CATKnotVector            *  iNewKV              ,
                                                                       CATMathNxNBandSymMatrix  *&amp; oFirstMemberMat     ,
                                                                       CATMathMxNMatrix         *&amp; oSecondMemberMat    );

            void                       GetTolerance             (const CATTolerance             *&amp; iTolObject          ) const;

            void                       SetTolerance             (const CATTolerance              &amp; iTolObject          = CATGetDefaultTolerance());

            void                       SetSoftwareConfiguration (      CATSoftwareConfiguration *  iConfig             );

  protected :
    //  If you want to change globaly the KnotVector
    //  of your CATMathNurbsMultiForm (used for degree reduction).
    //  WARNING : This method can lead to important modification.
    //  If you impose some continuities at ends of the multiform,
    //  be aware of the number of freedom degree of your result
    //  KnotVector : NewNumberOfCPs &gt;= iContinuityLeft + iContinuityRight + 2
    //  WARNING : if there is not enough freedom degree, nothing will be done.
            void               ChangeKnotValuesAndMultiplicities(const CATKnotVector            *  iNewKV              ,
                                                                       CATLONG32                   SameKnots           ,
                                                                       CATLONG32                   iContinuityL        = 0,
                                                                       CATLONG32                   iContinuityR        = 0);


            void               ChangeKnotValuesAndMultiplicities(const CATKnotVector            *  iNewKV              ,
                                                                       CATMathNxNBandSymMatrix  *&amp; oFirstMemberMat     ,
                                                                       CATMathMxNMatrix         *&amp; oS                  );

            void               Clear                            ();

   private:

            void               Init                             (      CATSoftwareConfiguration *  iConfig             ,
                                                                 const CATTolerance             *  iTolObject         );


            void               InitWithSetOfPointsND            (const CATKnotVector            *  iKnotVector        ,
                                                                 const CATMathSetOfPointsND     *  iPoints            ,
                                                                 const CATMathSetOfPointsND     *  iFstDer            ,
                                                                 const CATMathSetOfPointsND     *  iSndDer            ,
                                                                       CATLONG32                   iOptimiseContinuity
                                                                );


            void               InitByHermiteInterpolation       (const CATMathSetOfPointsND     *  iPts               ,
                                                                 const double                   *  iParameters        );


            void               InitWithCurve                    (const CATCurve                 *  iCurve             ,
                                                                 const CATCrvLimits             *  iCrvLim
                                                                );
            void               InitWithSetOfPoints              (const CATMathSetOfPoints      **  iSetOfPoints       ,
                                                                 const CATLONG32                 &amp; iIsRational        ,
                                                                 const CATKnotVector            *  iKnotVector        ,
                                                                 const CATLONG32                 &amp; iDimension         ,
                                                                 const CATLONG32                 &amp; iNumberOfForms     ,
                                                                 const double                   *  iWeights
                                                                );


            void               InitWithBipar                    (const CATMathNurbsBipar        *  iMathNurbsBipar    ,
                                                                 const CATLONG32                 &amp; iDir
                                                                );


            void               InitWithSurface                  (const CATLONG32                 &amp; iDir               ,
                                                                 const CATNurbsSurface          *  iSurface           ,
                                                                 const CATSurLimits             *  iSurLimits
                                                                );

   
    //------------------- Data -------------------
  public :
  protected :
    const   CATTolerance             * _TolObject    ;
            CATSoftwareConfiguration * _Config       ;
            double                   * _Weights      ;

            CATMathPoint             * _tabOfCPs     ;

            CATKnotVector            * _KnotVector   ;

            CATLONG32                  _Dimension    ;
            CATLONG32                  _Offset       ;
            CATLONG32                  _NumberOfForms;
            CATLONG32                  _IsRational   ;  // 0 : No, 1 : Yes
            // -- Limits (not mandatory) --
            CATLONG32                  _IsLimited    ;  // 0 : No, 1 : Yes,
                                                        // 2:yes and empty domain of validity
            double                     _Start        ;  // if limited and the domain of validity is not empty
            double                     _End          ;  // if limited and the domain of validity is not empty


};

#endif
</div>
    
    <div class="navigation">
        <div><a href="CATMacroPoint.html">‚Üê ‰∏ä‰∏ÄÈ°µ: CATMacroPoint.h</a></div>
        <div><a href="CATMathSideEval.html">‰∏ã‰∏ÄÈ°µ: CATMathSideEval.h ‚Üí</a></div>
    </div>
</body>
</html>