<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CAADoc/CAAxPDMInterfaces.edu/ProtectedInterfaces/CAASysDRMCtrl.h</title>
    <style>
        body {
            font-family: 'Consolas', 'Monaco', monospace;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .header {
            background-color: #2c3e50;
            color: white;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        .navigation {
            display: flex;
            justify-content: space-between;
            margin: 15px 0;
            padding: 10px;
            background-color: #ecf0f1;
            border-radius: 5px;
        }
        .navigation a {
            color: #2980b9;
            text-decoration: none;
            padding: 5px 10px;
            background-color: white;
            border-radius: 3px;
            border: 1px solid #bdc3c7;
        }
        .navigation a:hover {
            background-color: #3498db;
            color: white;
        }
        .content {
            background-color: white;
            padding: 20px;
            border-radius: 5px;
            border: 1px solid #bdc3c7;
            white-space: pre-wrap;
            font-size: 14px;
            line-height: 1.4;
            overflow-x: auto;
        }
        .back-to-index {
            text-align: center;
            margin: 15px 0;
        }
        .back-to-index a {
            color: #27ae60;
            text-decoration: none;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>CAADoc/CAAxPDMInterfaces.edu/ProtectedInterfaces/CAASysDRMCtrl.h</h1>
    </div>
    
    <div class="navigation">
        <div><a href="../PrivateInterfaces/ExportedByCAAxPDMToolbar.html">‚Üê ‰∏ä‰∏ÄÈ°µ: ExportedByCAAxPDMToolbar.h</a></div>
        <div><a href="../../../CAAFreeStyleItf/PublicGenerated/win_b64/TIE_CATIFreeStyleWorkshopAddin.html">‰∏ã‰∏ÄÈ°µ: TIE_CATIFreeStyleWorkshopAddin.h ‚Üí</a></div>
    </div>
    
    <div class="back-to-index">
        <a href="index.html">üìÅ ËøîÂõûÁõÆÂΩï</a>
    </div>
    
    <div class="content">/* COPYRIGHT DASSAULT SYSTEMES 2006 */

#ifndef __CAASysDRMCtrlH
#define __CAASysDRMCtrlH

#ifdef _WINDOWS_SOURCE
#ifdef __CAAxPDMDRMILB
#define ExportedByCAASysDRMCtrl __declspec(dllexport)
#else
#define ExportedByCAASysDRMCtrl __declspec(dllimport)
#endif
#else
#define ExportedByCAASysDRMCtrl
#endif
#include &quot;CATWTypes.h&quot;

class ExportedByCAASysDRMCtrl CAASysSymetricProvider
{
 public:
  enum Mode { ECB , CBC };
  enum Direction { crypt , decrypt };
  CAASysSymetricProvider();
  virtual ~CAASysSymetricProvider ();

/**
 * Inits the symetric provider.
 * &lt;br&gt;&lt;b&gt;Role&lt;/b&gt;: Inits the symetric provider.
 * @param  mode [i]
 *  the mode ECB or CBC.
 * @param  dir [i]
 *  Usage mode- encryption or decryption.
 * @param key [i]
 *  the symetric key.
 * @param KeyLen [i]
 *  the symetric key length.
 * @return
 *   &lt;b&gt;Legal values&lt;/b&gt;:
 *   &lt;br&gt;&lt;tt&gt; S_OK :&lt;/tt&gt;on Success.
 *   &lt;br&gt;&lt;tt&gt; E_FAIL :&lt;/tt&gt; on error.
*/   
  HRESULT InitProvider ( Mode mode, Direction dir,
			 unsigned char * key, size_t KeyLen);

/**
 * Encrypts data.
 * &lt;br&gt;&lt;b&gt;Role&lt;/b&gt;: Encrypts a data buffer which size is a multiple of the cipher
 * block size.
 * @param  iPT [i]
 *  the plain text.
 * @param  iPTLen [i]
 *   plain text length in bytes which must be a multiple of the cipher
 *   block size.
 * @param oCT [io]
 *  the cipher text previously allocated.
 * @param oCTLen [o]
 *  the cipher text length - should be equal to iPTLen.
 * @return
 *   &lt;b&gt;Legal values&lt;/b&gt;:
 *   &lt;br&gt;&lt;tt&gt; S_OK :&lt;/tt&gt;on Success.
 *   &lt;br&gt;&lt;tt&gt; E_FAIL :&lt;/tt&gt; on error.
*/   
  HRESULT Encrypt ( void *iPT, size_t iPTLen, void *ioCT,size_t &amp;oCTLen);
/**
 * Decrypts data.
 * &lt;br&gt;&lt;b&gt;Role&lt;/b&gt;: Decrypts a data buffer which size is a multiple of the cipher
 * block size.
 * @param  iCT [i]
 *  the cipher text.
 * @param  iCTLen [i]
 *   cipher text length in bytes which must be a multiple of the cipher
 *   block size.
 * @param oPT [io]
 *  the plain text previously allocated.
 * @param oPTLen [o]
 *  the plain text length - should be equal to iCTLen.
 * @return
 *   &lt;b&gt;Legal values&lt;/b&gt;:
 *   &lt;br&gt;&lt;tt&gt; S_OK :&lt;/tt&gt;on Success.
 *   &lt;br&gt;&lt;tt&gt; E_FAIL :&lt;/tt&gt; on error.
*/   
  HRESULT Decrypt ( void *iCT, size_t iCTLen, void *ioPT,size_t &amp;oPTLen);
 private:
  void * _Provider;
};


  


class CATUnicodeString;

class ExportedByCAASysDRMCtrl CAASysDRMCtrl
{
 public :
  CAASysDRMCtrl();
  virtual ~CAASysDRMCtrl();

/**
 * Creates or return the controller for DRM.
 * &lt;br&gt;&lt;b&gt;Role&lt;/b&gt;:Creates or gets the unique DRM controller.
 * @return
 *   &lt;b&gt;Legal values&lt;/b&gt;:
 *   &lt;br&gt;&lt;tt&gt; not NULL :&lt;/tt&gt;on Success the pointer on the unique controller.
 *   &lt;br&gt;&lt;tt&gt; NULL :&lt;/tt&gt; on error.
*/   
 static CAASysDRMCtrl *GetCtrl ();

/**
 * Sets the rights for the session.
 * &lt;br&gt;&lt;b&gt;Role&lt;/b&gt;: Defines the rights associated to a list of users, that will
 * used for all documents in the current session.
 * @param  iUsers [i]
 *  an array of users
 * @param  iRights [i]
 *  array of associated rights.
 * @param  iNb [i]
 *  the numbers of elements of the previously defined arrays
 * @return
 *   &lt;b&gt;Legal values&lt;/b&gt;:
 *   &lt;br&gt;&lt;tt&gt; S_OK :&lt;/tt&gt;on Success.
 *   &lt;br&gt;&lt;tt&gt; E_FAIL :&lt;/tt&gt; on error.
*/   
  HRESULT SetAuthorization(CATUnicodeString *iUsers, DWORD *iRights, int iNb);

/**
 * Gets the rights for the session.
 * &lt;br&gt;&lt;b&gt;Role&lt;/b&gt;: Reads the rights associated to a list of users, that will
 * used for all documents in the current session.
 * @param  iUsers [i]
 *  an array of users
 * @param  iRights [i]
 *  array of associated rights.
 * @param  iNb [i]
 *  the numbers of elements of the previously defined arrays
 * @return
 *   &lt;b&gt;Legal values&lt;/b&gt;:
 *   &lt;br&gt;&lt;tt&gt; S_OK :&lt;/tt&gt;on Success.
 *   &lt;br&gt;&lt;tt&gt; E_FAIL :&lt;/tt&gt; on error.
*/   
  HRESULT GetAuthorization(CATUnicodeString *&amp;oUsers, DWORD *&amp;oRights, int&amp; oNb);
  
  HRESULT GetDecryptAuthorization( char *iRight, size_t iSize,
     CATUnicodeString *&amp;oUsers, DWORD *&amp;oRights, int&amp; oNb);

  HRESULT GetEncryptAuthorization(CATUnicodeString* iUsers, DWORD* iRights, int iNb,
     char* &amp;oRight, size_t&amp; oSize);

/**
 * Sets the DRM activation.
 * &lt;br&gt;&lt;b&gt;Role&lt;/b&gt;: Turns ON or Off the DRM. 
 * @param  iActivation [i]
 *  the DRM activation.
 * @return
 *   &lt;b&gt;Legal values&lt;/b&gt;:
 *   &lt;br&gt;&lt;tt&gt; S_OK :&lt;/tt&gt;on Success.
 *   &lt;br&gt;&lt;tt&gt; E_FAIL :&lt;/tt&gt; on error.
*/   
  HRESULT SetDRMActivation( int iActivation);

/**
 * Gets the DRM activation.
 * &lt;br&gt;&lt;b&gt;Role&lt;/b&gt;: Get the DRM activation status. 
 * @param  oActivation [o]
 *  the DRM activation.
 * @return
 *   &lt;b&gt;Legal values&lt;/b&gt;:
 *   &lt;br&gt;&lt;tt&gt; S_OK :&lt;/tt&gt;on Success.
 *   &lt;br&gt;&lt;tt&gt; E_FAIL :&lt;/tt&gt; on error.
*/   
  HRESULT GetDRMActivation( int &amp;oActivation);


/**
 * Sets the current logged DRM user.
 * &lt;br&gt;&lt;b&gt;Role&lt;/b&gt;: Sets the current logged DRM user.
 * @param  iUser [i]
 *   user name
 * @param  iPwd [i]
 *  associated password.
 * @return
 *   &lt;b&gt;Legal values&lt;/b&gt;:
 *   &lt;br&gt;&lt;tt&gt; S_OK :&lt;/tt&gt;on Success.
 *   &lt;br&gt;&lt;tt&gt; E_FAIL :&lt;/tt&gt; on error.
*/   
  HRESULT UpdateCtrl(const char *iUser, const char *iPwd) ;

/**
 * Retrieves the current logged DRM users name.
 * &lt;br&gt;&lt;b&gt;Role&lt;/b&gt;: Retrieves the current logged DRM users name.
 * @param  oUser [o]
 *   user name
 * @return
 *   &lt;b&gt;Legal values&lt;/b&gt;:
 *   &lt;br&gt;&lt;tt&gt; S_OK :&lt;/tt&gt;on Success.
 *   &lt;br&gt;&lt;tt&gt; E_FAIL :&lt;/tt&gt; on error.
*/   
  HRESULT GetCurrentUser (CATUnicodeString &amp;oUser) ;


/**
 * Retrieves if one has explicitly logged into DRM.
 * &lt;br&gt;&lt;b&gt;Role&lt;/b&gt;: Retrieves if one has explicitly logged into DRM.
 * @param  oLogged [o]
 *   login status 
 * @return
 *   &lt;b&gt;Legal values&lt;/b&gt;:
 *   &lt;br&gt;&lt;tt&gt; S_OK :&lt;/tt&gt;on Success.
 *   &lt;br&gt;&lt;tt&gt; E_FAIL :&lt;/tt&gt; on error.
*/
  HRESULT IsLogged ( int &amp;oLogged);

/**
 * Read DRM Profile
 * &lt;br&gt;&lt;b&gt;Role&lt;/b&gt;:Read DRM profile to define which operation are allowed
 * @param  oProfile [out]
 *   &lt;b&gt;Legal values&lt;/b&gt;:
 *   &lt;br&gt;&lt;tt&gt; 0 :&lt;/tt&gt;Author.
 *   &lt;br&gt;&lt;tt&gt; 1 :&lt;/tt&gt;Design supplier.
 *   &lt;br&gt;&lt;tt&gt; 2 :&lt;/tt&gt;Downstream supplier.
 * @return
 *   &lt;b&gt;Legal values&lt;/b&gt;:
 *   &lt;br&gt;&lt;tt&gt; S_OK :&lt;/tt&gt;on Success.
 *   &lt;br&gt;&lt;tt&gt; E_FAIL :&lt;/tt&gt; on error.
 */
  HRESULT DRMGetProfile(int&amp; oProfile);

/**
 * Initialize DRM Profile
 * &lt;br&gt;&lt;b&gt;Role&lt;/b&gt;:Choose DRM profile to define which operation are allowed
 * @param  iProfile [in]
 *   &lt;b&gt;Legal values&lt;/b&gt;:
 *   &lt;br&gt;&lt;tt&gt; 0 :&lt;/tt&gt;Author.
 *   &lt;br&gt;&lt;tt&gt; 1 :&lt;/tt&gt;Design supplier.
 *   &lt;br&gt;&lt;tt&gt; 2 :&lt;/tt&gt;Downstream supplier.
 * @return
 *   &lt;b&gt;Legal values&lt;/b&gt;:
 *   &lt;br&gt;&lt;tt&gt; S_OK :&lt;/tt&gt;on Success.
 *   &lt;br&gt;&lt;tt&gt; E_FAIL :&lt;/tt&gt; on error.
 */
  HRESULT DRMSetProfile(int iProfile);

/**
 * Sets the symetric key size.
 * &lt;br&gt;&lt;b&gt;Role&lt;/b&gt;: Sets the symetric key size in byte.
 * @param  iSize [i]
 *   the key size 
 * @return
 *   &lt;b&gt;Legal values&lt;/b&gt;:
 *   &lt;br&gt;&lt;tt&gt; S_OK :&lt;/tt&gt;on Success.
 *   &lt;br&gt;&lt;tt&gt; E_FAIL :&lt;/tt&gt; on error.
*/
  HRESULT SetSymetricKeySize( int iSize);

/**
 * Gets the symetric key size.
 * &lt;br&gt;&lt;b&gt;Role&lt;/b&gt;: Gets the symetric key size in byte.
 * @param  oSize [o]
 *   the key size 
 * @return
 *   &lt;b&gt;Legal values&lt;/b&gt;:
 *   &lt;br&gt;&lt;tt&gt; S_OK :&lt;/tt&gt;on Success.
 *   &lt;br&gt;&lt;tt&gt; E_FAIL :&lt;/tt&gt; on error.
*/
  HRESULT GetSymetricKeySize( int&amp; oSize);
 

/** The following methods control the encryption :
 *  Creation of a one shot symetric key for the encryption of the data.
 *  Encryption-Decryption with a symetric algorithm of data.
 *  Export-Import of these symetric keys in a data blobs.
 *  Export-Import of the DRM authorization in a data blobs.
*/

/**
 * Generates a one-shot symetric key.
 * &lt;br&gt;&lt;b&gt;Role&lt;/b&gt;: Generates a one-shot symetric key to encrypt a given document.
 * @param  oKey [o]
 *  the symetric key.
 * @param  oKeySize [o]
 *  the symetric key Size.
 * @return
 *   &lt;b&gt;Legal values&lt;/b&gt;:
 *   &lt;br&gt;&lt;tt&gt; S_OK :&lt;/tt&gt;on Success.
 *   &lt;br&gt;&lt;tt&gt; E_FAIL :&lt;/tt&gt; on error.
*/   
  HRESULT DeriveSymetricKey (unsigned char *&amp;oKey, size_t &amp;oKeySize);

/**
 * Generates an encrypted marshalled blob of the symetric key.
 * &lt;br&gt;&lt;b&gt;Role&lt;/b&gt;: Generates an encrypted marshalled blob of the symetric key 
 * used for a given document that can be send to @href DRMExportEnveloppe .
 * @param  iKey [i]
 *  the symetric key.
 * @param  iKeySize [i]
 *  the symetric key Size.
 * @param  oCryptedKey [o]
 *  the resulting encrypted marshalled buffer.
 * @param  oCryptedKeySize [o]
 *  the size of the encrypted marshalled buffer.
 * @return
 *   &lt;b&gt;Legal values&lt;/b&gt;:
 *   &lt;br&gt;&lt;tt&gt; S_OK :&lt;/tt&gt;on Success.
 *   &lt;br&gt;&lt;tt&gt; E_FAIL :&lt;/tt&gt; on error.
*/   
  HRESULT EncryptSymetricKey (unsigned char *iKey, int iKeySize,
			      void  *&amp;oCryptedkey, size_t &amp;oCryptedKeySize);

/**
 * Retrieves a symetric key from an encrypted marshalled blob.
 * &lt;br&gt;&lt;b&gt;Role&lt;/b&gt;:Retrieves a symetric key from an encrypted marshalled blob that
 * has been previously created with @href EncryptSymetricKey.
 * @param  iCrypedKey [i]
 *  the symetric key.
 * @param  iKeySize [i]
 *  the symetric key Size.
 * @param  oKey [o]
 *  the resulting decrypted symetric key.
 * @param  oKeySize [o]
 *  the size of the decrypted key.
 * @return
 *   &lt;b&gt;Legal values&lt;/b&gt;:
 *   &lt;br&gt;&lt;tt&gt; S_OK :&lt;/tt&gt;on Success.
 *   &lt;br&gt;&lt;tt&gt; DRM_E_NOKEY :&lt;/tt&gt; No key in the buffer.
 *   &lt;br&gt;&lt;tt&gt;  DRM_E_INSUFFICIENTMEMORY:&lt;/tt&gt; no more memory.
*/   
  HRESULT DecryptSymetricKey (const void *iCyptedKey, size_t iKeySize,
			      unsigned char *&amp;oKey, size_t &amp;oKeySize);



/**
 * Generates an encrypted marshalled blob of the rights.
 * &lt;br&gt;&lt;b&gt;Role&lt;/b&gt;: Generates an encrypted marshalled blob of the rights 
 * associated to a given document.
 * @param  oRight [o]
 *  the right blob.
 * @param  oSize [i]
 *  Size of the buffer.
 * @return
 *   &lt;b&gt;Legal values&lt;/b&gt;:
 *   &lt;br&gt;&lt;tt&gt; S_OK :&lt;/tt&gt;on Success.
 *   &lt;br&gt;&lt;tt&gt; E_FAIL :&lt;/tt&gt; on error.
*/   
  HRESULT EncryptAuthorization( char *&amp;oRight, size_t &amp;oSize);

/**
 * Retrieves the rights associated to a given document.
 * &lt;br&gt;&lt;b&gt;Role&lt;/b&gt;: Retrieves the rights associated to a given document from an 
 * encrypted marshalled blob.
 * @param  iRight [o]
 *  the right blob.
 * @param  iSize [i]
 *  Size of the buffer.
 *  @param  oRight [o]
 *  the set of authorization associated to the document.
 * @return
 *   &lt;b&gt;Legal values&lt;/b&gt;:
 *   &lt;br&gt;&lt;tt&gt; S_OK :&lt;/tt&gt;on Success.
 *   &lt;br&gt;&lt;tt&gt; DRM_E_CRYPTCORRUPTION:&lt;/tt&gt; the blob can not be decrypted.
 *   &lt;br&gt;&lt;tt&gt; E_FAIL :&lt;/tt&gt; on error.
*/   
  HRESULT DecryptAuthorization( char *iRight, size_t iSize, DWORD &amp;oRight);


/**
 * Retrieves the provider for the symetric encryption algorithm.
 * &lt;br&gt;&lt;b&gt;Role&lt;/b&gt;: Retrieves the provider for the symetric encryption algorithm.
 * @param oProvider
 *   pointer to the provider.
 * @return
 *   &lt;b&gt;Legal values&lt;/b&gt;:
 *   &lt;br&gt;&lt;tt&gt; S_OK :&lt;/tt&gt;on Success.
 *   &lt;br&gt;&lt;tt&gt; E_FAIL :&lt;/tt&gt; on error.
*/   
  HRESULT GetSymetricProvider ( CAASysSymetricProvider *&amp;oProvider);


 private:
/**
 * pointer on the DRM controller.
*/
 static CAASysDRMCtrl *_DRMCtrl;

/**
 * Key size in byte
*/
  static int _KeySize;

/**
 * Currently logged DRM user.
*/
  char * _User;
/**
 * Current password of the logged DRM user.
*/
  char * _Pwd;

/**
 * Referenced users in the DRM context.
*/
  CATUnicodeString *_DRMUsers;
/**
 * Associated Rights of the users in the DRM context.
*/
  DWORD *_Rights;
/**
 * Number of referenced users in the DRM context.
*/
  int _NbUsers;
/**
 * Activation status of the DRM.
*/
  int _Activated;

/**
  * Login status.
*/
  int _Logged;
/**
  * Interactive status.
*/
  int _BatchMode;
/**
  * DRM Profile
*/
  int _DRMProfile;


};
#endif

  
</div>
    
    <div class="navigation">
        <div><a href="../PrivateInterfaces/ExportedByCAAxPDMToolbar.html">‚Üê ‰∏ä‰∏ÄÈ°µ: ExportedByCAAxPDMToolbar.h</a></div>
        <div><a href="../../../CAAFreeStyleItf/PublicGenerated/win_b64/TIE_CATIFreeStyleWorkshopAddin.html">‰∏ã‰∏ÄÈ°µ: TIE_CATIFreeStyleWorkshopAddin.h ‚Üí</a></div>
    </div>
</body>
</html>