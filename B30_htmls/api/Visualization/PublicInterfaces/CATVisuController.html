<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Visualization/PublicInterfaces/CATVisuController.h</title>
    <style>
        body {
            font-family: 'Consolas', 'Monaco', monospace;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .header {
            background-color: #2c3e50;
            color: white;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        .navigation {
            display: flex;
            justify-content: space-between;
            margin: 15px 0;
            padding: 10px;
            background-color: #ecf0f1;
            border-radius: 5px;
        }
        .navigation a {
            color: #2980b9;
            text-decoration: none;
            padding: 5px 10px;
            background-color: white;
            border-radius: 3px;
            border: 1px solid #bdc3c7;
        }
        .navigation a:hover {
            background-color: #3498db;
            color: white;
        }
        .content {
            background-color: white;
            padding: 20px;
            border-radius: 5px;
            border: 1px solid #bdc3c7;
            white-space: pre-wrap;
            font-size: 14px;
            line-height: 1.4;
            overflow-x: auto;
        }
        .back-to-index {
            text-align: center;
            margin: 15px 0;
        }
        .back-to-index a {
            color: #27ae60;
            text-decoration: none;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>Visualization/PublicInterfaces/CATVisuController.h</h1>
    </div>
    
    <div class="navigation">
        <div><a href="CATVisViewerFeedbackEvent.html">‚Üê ‰∏ä‰∏ÄÈ°µ: CATVisViewerFeedbackEvent.h</a></div>
        <div><a href="CATVisualization.html">‰∏ã‰∏ÄÈ°µ: CATVisualization.h ‚Üí</a></div>
    </div>
    
    <div class="back-to-index">
        <a href="index.html">üìÅ ËøîÂõûÁõÆÂΩï</a>
    </div>
    
    <div class="content">#ifndef CATVisuController_H
#define CATVisuController_H
/** @CAA2Required */
/**********************************************************************/
/* DON T DIRECTLY INCLUDE THIS HEADER IN YOUR APPLICATION CODE. IT IS */
/* REQUIRED TO BUILD CAA APPLICATIONS BUT IT MAY DISAPEAR AT ANY TIME */
/**********************************************************************/
/*
//**********************************************************************
//  CATIA Version 5 Release 1 Framework VFW2
//  Copyright Dassault Systemes 1996
//**********************************************************************
//  Abstract:
//  ---------
//    This object is the masterpiece of the MVC architecture and ensures that
//    communication between the model and the vues are made possible.
//
//**********************************************************************
//  Usage:   
//  ------
//
//**********************************************************************
//  Inheritance:
//  ------------
//                CATVisuController
//                  CATEventSubscriber (SYSTEM Framework).
//
//**********************************************************************
//  Main Methods:
//  -------------
//            Set and Get evaluation primitive mode
//               SetPrimitiveEvaluationMode
//               GetprimitiveEvaluationMode
//            Visualization runtime settings (LODs, Textures, Edges)
//            Editing methods
//               New
//               Delete
//               Modify
//               SetHighlightMode
//               SetShowMode
//               ModifyColor
//               BuildRep
//               AddManip
//               AddManipOnPath
//               RemoveManip
//               RemoveManipOnPath
//            Multi viewer management
//               AddViewer
//               RemoveViewer
//            Decode graphic management (selection)
//               static DecodeNextGraphicElement
//               (protected) DecodeGraphic
//            Class information
//               InitClassList()
//               GetNextClassElement()
//----------------------------------------------------------------------------
//       
*/

#include &quot;CATVisualization.h&quot;
#include &quot;list.h&quot;
#include &quot;CATEventSubscriber.h&quot;
#include &quot;CATVue.h&quot;
#include &quot;CATRepPath.h&quot;
#include &quot;CATDisplayType.h&quot;

class CAT4x4Matrix;
class CAT3x3Matrix;
class CATRep;
//class CATRepTable;
class CATViewer;
class CATModelIdentificator;
class CATManipulator;
class CATRepPath;
class CATViewer;
class CATPickPath;
class CATPSO;
class CATHSO;
class CATNotificationDispatcher;
class CATPathElement;
class CATPathElementRep;
class CATHLRVisuOutputMaker;
class CATHLRPlaneView;
class CATColorMap;
class CATVisuController;
class CATBaseUnknown;

//   useful define
#define DIRECT_ACCESS_TABLE  1

#include &quot;DefineCst.h&quot;
#include &quot;CATGenerativeAttribute.h&quot;


class ExportedByCATVisualization CATVisuController : public CATEventSubscriber
{
  friend class CATMarshallableVisuController ;
  CATDeclareClass;

  public:
  ///////


  CATVisuController();
  virtual ~CATVisuController();


  //  Set/Get Controller type 3D or 2D for instance
  //  ---------------------------------------------
  virtual void  SetType(VisuType itype);
  virtual VisuType GetType() const;
  

  // Current Set of Object management
  // --------------------------------
  virtual void AttachToPSO (CATPSO *);
  virtual void DetachFromPSO (CATPSO *);
  virtual void AttachToHSO (CATHSO *);
  virtual void DetachFromHSO (CATHSO *);
  virtual void CsoAddElements(const list&lt;CATPathElement&gt; &amp;, CATInteractiveContext);
  virtual void CsoAddElement (const CATPathElement &amp;, CATInteractiveContext);
  virtual void CsoRemoveElement (const CATPathElement &amp;, CATInteractiveContext);
  virtual void CsoRemoveElements(const list&lt;CATPathElement&gt; &amp;, CATInteractiveContext);
  virtual CATRepPath * CreateOperationElementRepresentation ( const CATPathElement &amp;,
                                                      CATInteractiveContext,
                                                      CATGenerativeAttribute);
  virtual HRESULT BuildHighlightLook ( CATRep &amp;iRep,
                              const CATPathElement	&amp;iPathElement,
		                          CATRepPath &amp;oRepPath );

  virtual HRESULT BuildRepPath ( CATRep &amp;iRep,
                        const CATPathElement &amp;iPathElement,
		                    CATRepPath &amp;oRepPath );
 
  virtual CATPathElement GetModelLocalization ( CATBaseUnknown * );

   // model events management
   // -----------------------
   virtual void AttachToModelDispatcher (CATNotificationDispatcher *);
   virtual void DetachFromModelDispatcher (CATNotificationDispatcher *);
   virtual void SomethingHappensInPSO(CATCallbackEvent, void *, 
                                      CATNotification *, CATSubscriberData, 
                                      CATCallback);
   virtual void SomethingHappensInHSO(CATCallbackEvent, void *, 
                                      CATNotification *, CATSubscriberData, 
                                      CATCallback);
   virtual void SomethingHappens(CATCallbackEvent, void *, CATNotification *, 
                                 CATSubscriberData, CATCallback);
  
  
  // Settings for usage of some important parameters:
  // ------------------------------------------------
  //   At this point, decision may be taken whether to use data corresponding
  //   to the managed parameter or not. If the data is not used, the parameter
  //   won&#x27;t be accessible for the whole session duration, unless .cgr files are
  //   loaded again entirely, or the parameter is generated again. 1: OK, 0: NO.
  
  static void SetLODUsageMode     (int use_mode);
  static void SetTextureUsageMode (int use_mode);
  static void SetEdgeUsageMode    (int use_mode);
  static int GetLODUsageMode     (void);
  static int GetTextureUsageMode (void);
  static int GetEdgeUsageMode    (void);
  
  
  //  graphic model
  //  -------------
  virtual  CATRep * GetGraphicModel() const;
  virtual void SetGraphicModel(CATRep *iRep);


  //  graphic table
  //  -------------
  //virtual void SetAssociatedGraphicTable(CATRepTable *iTable);
  //virtual CATRepTable * GetAssociatedGraphicTable() const;
  virtual void SetRepInGraphicTable(CATRep *iRep,CATModelIdentificator &amp;iIdent);
  virtual CATRep *GetRepFromGraphicTable(CATModelIdentificator &amp;iIdent ) const;
  virtual CATRep * IsRepExisting(const CATModelIdentificator &amp;iIdent);
  virtual void SetNewIdentificator(CATRep *ioRep);


  //  dynamic behavior
  //  ----------------
  virtual void UnreferenceRep(CATModelIdentificator &amp;iIdent);
  virtual CATRep *GetRep(const CATModelIdentificator &amp;iIdent) const; 
  virtual CATRep * BuildRep(CATModelIdentificator &amp;iIdent);
  virtual void New( CATModelIdentificator &amp;son, CATModelIdentificator &amp;object);
  virtual void Delete ( CATModelIdentificator &amp;iIdent);
  virtual void Modify (CATModelIdentificator &amp;iIdent);
  virtual void ModifyMatrix(CATModelIdentificator &amp;iIdent,CAT4x4Matrix &amp;iMat);
  virtual void ModifyMatrix(CATModelIdentificator &amp;iIdent,CAT3x3Matrix &amp;iMat);
  virtual void SetHighlightMode ( CATModelIdentificator &amp;iIdent, int mode);
  virtual void SetShowMode      ( CATModelIdentificator &amp;iIdent, int showmode);
  virtual void ModifyColor(CATModelIdentificator &amp;iIdent,unsigned int iColor); 
  virtual void AddManipOnPath(CATManipulator *manip, CATPathElement &amp;path);
  virtual void AddManip(CATManipulator *manip, CATModelIdentificator &amp;ident);
  virtual void RemoveManip(CATManipulator *manip, CATModelIdentificator &amp;ident);
  virtual void RemoveManipOnPath(CATManipulator *manipulator, 
                                 CATPathElement &amp;path);
  virtual void FlushManipulators();
  virtual void UnreferenceManipulator(CATManipulator *manipulator);


  //  display
  //  -------
  virtual void DrawElement ( CATViewer &amp;, CATRep &amp;, int draw = 1 );
  virtual void DrawElements( CATViewer &amp;, list&lt;CATRep&gt; &amp;, int draw = 1 );
  virtual void UndrawElement ( CATViewer &amp;, CATRep &amp;, int draw = 1 );
  virtual void UndrawElements( CATViewer &amp;, list&lt;CATRep&gt; &amp;, int draw = 1 );
  virtual void AddRep ( CATViewer &amp;, CATRep &amp; );
  virtual void RemoveRep ( CATViewer &amp;, CATRep &amp; );
  virtual int Display(void);
  virtual void AddChild ( CATRep &amp;father, CATRep &amp;son );
  virtual void RemoveChild ( CATRep &amp;father, CATRep &amp;son );


  //  viewer management
  //  -----------------
  virtual void AddViewer(CATViewer &amp;iView);
  virtual void RemoveViewer(CATViewer &amp;iView);
  void InitViewerList();
  CATViewer *GetNextViewer();

  //  for end of application -&gt; viewers are destroyed before by dialog FW
  //  -------------------------------------------------------------------
  virtual void DisconnectFromViewers(CATViewer *viewer = NULL);


  //  current controller
  //  ------------------
  static CATVisuController * GetCurrentController();
  static void SetCurrentController(CATVisuController *iCntl);

  //  persistent identificator management
  //  -----------------------------------
  virtual void ChangeAllId();
  virtual int ComputePersistentIntId(int iVal);
  virtual int GetIdentificators(CATModelIdentificator ***oTab);
  virtual void SetPersistentId(CATModelIdentificator &amp;iId,
                               CATModelIdentificator &amp;iPersId);
 

  //  marshalling 
  //  -----------
  static void SetUnmarshallingController(CATVisuController *iCntl);
  static CATVisuController * GetUnmarshallingController();
  static CATVisuController * RestoreFromFile(char * filename);

  //  find the next representation from a model path
  //  ( this is used for BuildHighlightLook an BuildRepPath )
  //  -------------------------------------------------------
  virtual CATRep * FindNextRep ( const CATPathElement &amp;, int &amp;valid );

  //  decode graphic
  //  --------------
  // This one is to be called from the CATSelector, it look for the 
  // Next Rep in the pick path, find its controller, and call the 
  // DecodeGraphic on it. Do a PickPath-&gt;InitToTopRep before calling it.
  // (see also DecodeGraphic protected method)
   static HRESULT DecodeNextGraphicElement(const CATPickPath &amp;iPickPath,CATPathElement &amp;oPathElt);


  //  class information
  //  -----------------
  static void InitClassList();
  static CATVisuController *GetNextClassElement();

  // color map 
  virtual CATColorMap *GetColorMap();
  virtual void SetColorMap( CATColorMap * iColMap);

  // ressources for HLR display mode
  virtual CATHLRVisuOutputMaker *GetHLRVisuOutputMaker();
  virtual CATHLRPlaneView * GetHLRPlaneView (CATRep *rep);

  //  internal method to encapsulate the job done before and after
  //  deleting rep during modification
  //  ------------------------------------------------------------
  virtual void BeginModify();
  virtual void EndModify();

  protected:
  //////////

  // controller type for instance 2D, 3D (3D is the default value)
  // confer to define TYPE_2D, TYPE_3D
  VisuType _Type;

  //  overload this method to adapt it to your modelisation. If the
  //  model element do not know how to answer the question, ever call
  // DecodeNextGraphicElement if the Rep is a bag. or return NULL
  virtual HRESULT DecodeGraphic ( const CATPickPath &amp;iRepPath,
                         CATPathElement &amp;oPathElement );

 
  // List of modified representation paths
  list &lt;CATRepPath&gt; _pathToRedraw;

  // list of edited representation
  list &lt;CATRep&gt; _editedRep;
  list &lt;CATBaseUnknown&gt; _to_put_in_hso;

  // list of manipulator to add
  list &lt;CATManipulator&gt; _Manipulators;

  // list of identificator where manipulator has to be added
  list &lt;CATModelIdentificator&gt; _Identificators;

  //  Graphic table 
  //CATRepTable *   _GraphicTable;

  // the graphic model 
  CATRep * _GraphicModel;

// Color map
  CATColorMap *_ColorMap;

  // viewer
  list &lt;CATViewer&gt; _Viewers;

  //  the current controller identificator
  static CATVisuController * _CurrentCntl;

 // Type of Display
  CATDisplayType _layout;

  
  // Parameters for the loading configuration:
  // -----------------------------------------
  static char _lod_usage_mode;
  static char _texture_usage_mode;
  static char _edge_usage_mode;
  
  
  //  marhalling:
  // ------------
  int   _SizeTable;
  int _PersistentIdResquest;
  static CATVisuController *_CntlUnmarshalling;
  static int _LoadToCharge;
  static int _Version;

  // furtivity
  int _inhibFurtiveDraw;
  CATPSO *_pso;
  CATHSO *_hso;
  CATPSO *_lastPSO;
  CATHSO *_lastHSO;

  //  visu des manipulateurs sur sous elements
  list&lt;CATPathElementRep&gt; _pathManipulators;
  list&lt;CATPathElementRep&gt; _path;

  //  cso visualization
  list&lt;CATRep&gt; _csoElements;

  //  internal flag for modification
  //  ------------------------------
  int _everModify;

  private:
  ////////

  //  vue connexion
  CATCallback _vueConnexion;
  CATVueInteractiveState _vueState;

  //  model
  CATCallback _modelConnexion;
  CATNotificationDispatcher *_modelDispatcher;

  CATCallback _psoConnexion;
  CATCallback _hsoConnexion;

  //  class information
  static list&lt;CATVisuController&gt; _classList;
  
};
#endif 

</div>
    
    <div class="navigation">
        <div><a href="CATVisViewerFeedbackEvent.html">‚Üê ‰∏ä‰∏ÄÈ°µ: CATVisViewerFeedbackEvent.h</a></div>
        <div><a href="CATVisualization.html">‰∏ã‰∏ÄÈ°µ: CATVisualization.h ‚Üí</a></div>
    </div>
</body>
</html>