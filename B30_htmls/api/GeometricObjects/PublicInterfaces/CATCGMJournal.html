<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GeometricObjects/PublicInterfaces/CATCGMJournal.h</title>
    <style>
        body {
            font-family: 'Consolas', 'Monaco', monospace;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .header {
            background-color: #2c3e50;
            color: white;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        .navigation {
            display: flex;
            justify-content: space-between;
            margin: 15px 0;
            padding: 10px;
            background-color: #ecf0f1;
            border-radius: 5px;
        }
        .navigation a {
            color: #2980b9;
            text-decoration: none;
            padding: 5px 10px;
            background-color: white;
            border-radius: 3px;
            border: 1px solid #bdc3c7;
        }
        .navigation a:hover {
            background-color: #3498db;
            color: white;
        }
        .content {
            background-color: white;
            padding: 20px;
            border-radius: 5px;
            border: 1px solid #bdc3c7;
            white-space: pre-wrap;
            font-size: 14px;
            line-height: 1.4;
            overflow-x: auto;
        }
        .back-to-index {
            text-align: center;
            margin: 15px 0;
        }
        .back-to-index a {
            color: #27ae60;
            text-decoration: none;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>GeometricObjects/PublicInterfaces/CATCGMJournal.h</h1>
    </div>
    
    <div class="navigation">
        <div><a href="CATCGMContainerMngt.html">‚Üê ‰∏ä‰∏ÄÈ°µ: CATCGMContainerMngt.h</a></div>
        <div><a href="CATCGMJournalInfo.html">‰∏ã‰∏ÄÈ°µ: CATCGMJournalInfo.h ‚Üí</a></div>
    </div>
    
    <div class="back-to-index">
        <a href="index.html">üìÅ ËøîÂõûÁõÆÂΩï</a>
    </div>
    
    <div class="content">/* -*-c++-*- */
#ifndef CATCGMJournal_h_
#define CATCGMJournal_h_

// COPYRIGHT DASSAULT SYSTEMES  1999

/**
 * @CAA2Level L1
 * @CAA2Usage U1
 */ 

#include &lt;YP00IMPL.h&gt;
#include &quot;CATCGMNewArray.h&quot;
#include &quot;CATListOfCATGeometries.h&quot;
#include &quot;CATCGMVirtual.h&quot;
#include &quot;CATMathInline.h&quot;
#include &quot;CATIACGMLevel.h&quot;

/** @c++ansi fbq 2004-08-05.10:18:26 [Replace forward declaration by #include &lt;iosfwd.h&gt;] **/
#ifdef _CAT_ANSI_STREAMS
#include &lt;iosfwd.h&gt;
#else
class ostream;
#endif
class CATCGMJournalList;
class CATCGMJournalItem;
class CATCGMOutput;
class CATCGMAttrId;
class CATCGMStream;
class CATGeoFactory;

/**
 * Class defining the journal of the topological operations.
 * &lt;br&gt; The journal logs the modifications of the faces, free edges and free vertices
 * of topological objects. The journal is designed as a composite pattern: it represents a journal item 
 * ( @href CATCGMJournalItem ) and a list of items ( @href CATCGMJournalList ).
 * &lt;br&gt;You have to manage the creation and deletion of a journal. 
 * The journal items are created when you report new events inside the
 * journal list (@href CATCGMJournalList#Report, @href CATCGMJournalList#ReportUnspecModify ). The journal
 * items are deleted with the journal list in which they are imbedded, except if you have directly
 * created an item, without inserting it inside a journal list.
 * The journal information is also deleted with the journal it informs.
 */

class ExportedByYP00IMPL CATCGMJournal  : public CATCGMVirtual
{
public:

/**
 * Constructs a CGM journal.
 * @param iList
 * If not &lt;tt&gt;NULL&lt;/tt&gt;, a pointer to a journal list, inside which &lt;tt&gt;this&lt;/tt&gt; will be inserted after its creation.
 */
  CATCGMJournal(CATCGMJournalList * iList);
  /** @nodoc */
  CATCGMNewClassArrayDeclare;
  virtual ~CATCGMJournal();

/** 
 * The types of report.
 * @param None
 * The report is inactivated.
 * @param List
 * The report is a CATCGMJournalList
 * @param Creation
 * The report is a CATCGMJournalItem describing the creation of an object.
 * @param Modification
 * The report is a CATCGMJournalItem describing the modification of an object in another one.
 * @param Subdivision
 * The report is a CATCGMJournalItem describing the subdivision of an object in P other objects.
 * @param Absorption
 * The report is a CATCGMJournalItem describing the absorption of N objects inside P&gt;1 other objects.
 * @param Deletion
 * The report is a CATCGMJournalItem describing the deletion of an object.
 * @param Keep
 * The report is a CATCGMJournalItem describing that the object is not modified.
 * @param UnspecModif
 * One of the preceeding operations. 
 * @param Copy
 * By default, the input objects are considered to be kept.
 * @param NoCopy
 * By default, none input object is considered to be kept.
 */
  enum Type
    {
      None         = 0,   // inactivated report
      List         = 10,  // CATCGMJournalList
      Creation     = 21,  // CATCGMJournalItem 
      Modification = 23,  // CATCGMJournalItem : 1 -&gt; 1
      Subdivision  = 24,  // CATCGMJournalItem : 1 -&gt; P
      Absorption   = 25,  // CATCGMJournalItem : N -&gt; P  (P&gt;=1)
      Deletion     = 26,  // CATCGMJournalItem
      Keep         = 27,  // CATCGMJournalItem : 1 -&gt; itself

      UnspecModif  = 30,   
      
      Copy         = 40,   
      NoCopy       = 41   
    };
/**
 * Returns the type of &lt;tt&gt;this&lt;/tt&gt; journal.
 * @return
 * The type of the journal.
 */
  virtual CATCGMJournal::Type GetType() const = 0;

/** 
 *  Casts &lt;tt&gt;this&lt;/tt&gt; into a journal list if possible.
 * @return
 * The casted pointer if &lt;tt&gt;this&lt;/tt&gt; is a CATCGMJournalList, &lt;tt&gt;NULL&lt;/tt&gt; otherwise.
 */
  virtual CATCGMJournalList * CastToReportList();

/** 
 *  Casts &lt;tt&gt;this&lt;/tt&gt; into a journal item if possible.
 * @return
 * The casted pointer if &lt;tt&gt;this&lt;/tt&gt; is a CATCGMJournalItem, &lt;tt&gt;NULL&lt;/tt&gt; otherwise.
 */
  virtual CATCGMJournalItem * CastToReportItem();
  
/** 
 *  Activates or deactivates &lt;tt&gt;this&lt;/tt&gt; journal.
 * @param iMode
 * The activation mode.
 * &lt;br&gt;&lt;b&gt;Legal values&lt;/b&gt;:
 *  0 inactive, 1 active
 */
  void SetActiveMode(short iMode);

/** 
 *  Returns the activation mode.
 * @return
 * The activation mode.
 * &lt;br&gt;&lt;b&gt;Legal values&lt;/b&gt;:
 *  0 inactive, 1 active
 */
#ifdef CATIACGMR418CAA
  INLINE short GetActiveMode() const;
#else
  short GetActiveMode() const;
#endif
  
/** @nodoc  */
  virtual void Dump(ostream &amp; ioWhereToWrite, int iIndent = 0) = 0;

/**
 * @nodoc
 * Dumps the content of &lt;tt&gt;this&lt;/tt&gt; journal item.
 * @param iWhereToWrite
 * The output to write the journal.
 * @param iIndent
 * The number of blanks before writing the journal.
 */
  virtual void Dump(CATCGMOutput &amp; ioWhereToWrite, int iIndent = 0) = 0;


/**  @nodoc  */
  virtual CATCGMJournal * Duplicate(CATCGMJournalList * iInList = 0, int iCopyNext = 1) const = 0;
  
/** 
 * DO NOT USE
 * &lt;br&gt;Automatically reports the attributes pointed by the objects before the operation, on the 
 * objects after the operation.
 * &lt;br&gt;Not available for a creation item.
 * @param iAttr
 * The type of attribute to report. If the objects before the operation point an attribute of this
 * type, the attribute will also be shared by the objects after modification.
 */
  virtual void MakeAttributesFollow(const CATCGMAttrId * iAttr) = 0;
  
/** @nodoc */
  INLINE unsigned short IncCounter();
/** @nodoc */
  INLINE unsigned short DecCounter();


/** @nodoc */
/*
* AddRef and Release mechanism which allows to handle the life cycle of the journal.
*
* USE WITH CAUTION
* -----------------
*
* There are two &quot;exclusive&quot; manners to manage the life cycle of the Journal
*
* 1 - The first manner is to use the new and delete operators to create and delete 
*     a CATCGMJournal and then use the InCounter() and DecCounter() mechanism to increment
*     and decrement the number of handler to the CATCGMJournal object. The mechanism 
*     of IncCounter() and DecCounter() doesn&#x27;t manage the destruction of the object
*     YOU HAVE TO USE the delete operator to remove it.
* 2 -  The second way is to use the new operator to create your CATCGMJournal object
*      and then use the AddRef() and Release() mechanism to increment
*      and decrement the number of handlers to the CATCGMObject object.
*      DO NOT USE the delete operator in this case since ht Release() method will delete
*      the CATCGMJournal object when there is no longer handler.
*/

/**
* Use AddRef when a new handler of the journal references it
*
* @return 
*   Number of objects that still reference the journal
*/
  INLINE unsigned short AddRef();
/** @nodoc */
/**
* Use Release when a handler want to unreference a journal that it handles.
* 
* @return 
*   Number of objects that still reference the journal. When this number reach 0 
*   the journal is deleted
*
*/
  INLINE unsigned short Release();


/** 
 * Discards a list of objects from the topological journal. 
 * This method is to be used with caution. Only objects 
 * which are not required by the backtracking mechanism can be discarded.
 * If not used properly, this method can lead to an invalid journal.
 * @param iToSimplify
 * The list of objects to be discarded from the journal.
 * @return
 * 0 if the objects can be removed - otherwise 1
 */
  virtual int ForgetObjects(const CATLISTP(CATGeometry) &amp; iToSimplify) = 0;
  

protected:
/**
 * Copy constructor.
 */
  CATCGMJournal( const CATCGMJournal &amp; iToCopy);

/**
 * Affectation operator.
 */
  CATCGMJournal&amp; operator = (const CATCGMJournal &amp; iToCopy);

  /** @nodoc */
  CATCGMJournalList * _pOwning;
  /** @nodoc */
  CATCGMJournal     * _pPrevious;
  /** @nodoc */
  CATCGMJournal     * _pNext;

  /** @nodoc */
  // un bloc de 32 bits ...
  struct
  {
    unsigned  _ActiveMode : 1; 
    unsigned  _Counter    :31;
  } _Data;

  /** @nodoc */
  static CATCGMJournal::Type GetMemoryType(const unsigned short      iType);
  /** @nodoc */
  static unsigned short      GetStreamType(const CATCGMJournal::Type iType);

  friend class ExportedByYP00IMPL CATCGMJournalList;
  friend class ExportedByYP00IMPL CATCGMJournalItem;

	/** @nodoc */
	// New Counter for AddRef and Release mecanism
	unsigned short _RefCounter;

};

INLINE unsigned short CATCGMJournal::IncCounter()
{
  return ++_Data._Counter;
}

INLINE unsigned short CATCGMJournal::DecCounter()
{
  return --_Data._Counter;
}

/** @nodoc */
INLINE unsigned short CATCGMJournal::AddRef()
{
  return (++_RefCounter);
}
/** @nodoc */
INLINE unsigned short CATCGMJournal::Release()
{	
	if ( (--_RefCounter) &gt; 0 )
		return _RefCounter;
	// Delete Object if no more pointers handle it
	else
	{
		delete this;
		return 0;
	}
}

#ifdef CATIACGMR418CAA
//-----------------------------------------------------------------------------
// GetActiveMode
//-----------------------------------------------------------------------------
INLINE short CATCGMJournal::GetActiveMode() const
{
  return _Data._ActiveMode;
}
#endif

#endif
</div>
    
    <div class="navigation">
        <div><a href="CATCGMContainerMngt.html">‚Üê ‰∏ä‰∏ÄÈ°µ: CATCGMContainerMngt.h</a></div>
        <div><a href="CATCGMJournalInfo.html">‰∏ã‰∏ÄÈ°µ: CATCGMJournalInfo.h ‚Üí</a></div>
    </div>
</body>
</html>