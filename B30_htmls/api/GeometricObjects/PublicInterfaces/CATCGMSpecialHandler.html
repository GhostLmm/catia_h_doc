<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GeometricObjects/PublicInterfaces/CATCGMSpecialHandler.h</title>
    <style>
        body {
            font-family: 'Consolas', 'Monaco', monospace;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .header {
            background-color: #2c3e50;
            color: white;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        .navigation {
            display: flex;
            justify-content: space-between;
            margin: 15px 0;
            padding: 10px;
            background-color: #ecf0f1;
            border-radius: 5px;
        }
        .navigation a {
            color: #2980b9;
            text-decoration: none;
            padding: 5px 10px;
            background-color: white;
            border-radius: 3px;
            border: 1px solid #bdc3c7;
        }
        .navigation a:hover {
            background-color: #3498db;
            color: white;
        }
        .content {
            background-color: white;
            padding: 20px;
            border-radius: 5px;
            border: 1px solid #bdc3c7;
            white-space: pre-wrap;
            font-size: 14px;
            line-height: 1.4;
            overflow-x: auto;
        }
        .back-to-index {
            text-align: center;
            margin: 15px 0;
        }
        .back-to-index a {
            color: #27ae60;
            text-decoration: none;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>GeometricObjects/PublicInterfaces/CATCGMSpecialHandler.h</h1>
    </div>
    
    <div class="navigation">
        <div><a href="CATCGMOperatorDebug.html">‚Üê ‰∏ä‰∏ÄÈ°µ: CATCGMOperatorDebug.h</a></div>
        <div><a href="CATCGMStream.html">‰∏ã‰∏ÄÈ°µ: CATCGMStream.h ‚Üí</a></div>
    </div>
    
    <div class="back-to-index">
        <a href="index.html">üìÅ ËøîÂõûÁõÆÂΩï</a>
    </div>
    
    <div class="content">#ifndef CATICGMSpecialHandler_H
#define CATICGMSpecialHandler_H

// COPYRIGHT DASSAULT SYSTEMES 2017
/** @CAA2Required */
//**********************************************************************
//* DON T DIRECTLY INCLUDE THIS HEADER IN YOUR APPLICATION CODE. IT IS *
//* REQUIRED TO BUILD CAA APPLICATIONS BUT IT MAY DISAPEAR AT ANY TIME *
//**********************************************************************    

//==========================================================================
// Specific handler declaration macros for CGM objects
// ---------------------------------------------------
//
// - inspired from CATBaseUnknown_var (copy October 4th 2017)
// - with added destructor declaration
// - with additional dedicated memory check leak spyer CATCGMSpecialHandlerSpyer()
//   (for _WINDOWS_SOURCE only)
// - spyer automatically activated in MEMORYCHECK replay
// - spyer may also be activated through environment variable
//
// Use:
// ---
// - replace CATDeclareHandler(CATICGMUnknown,CATBaseUnknown) 
//   by      CATCGMSpecialHandlerDeclare(CATICGMUnknown,CATBaseUnknown) 
//   in declaration file
// - replace CATImplementHandler(CATICGMUnknown,CATBaseUnknown) 
//   by      CATCGMSpecialHandlerImplement(CATICGMUnknown,CATBaseUnknown) 
//   in implementation file
//
// Note: 
// ---
// - read output traces for numbers of handlers in memory leak
// - use breakpoint on CATCGMSpecialHandlerSpyerBreakPoint() 
//   for target definition/reach on handler number
// - use export CATCGMSpecialHandler=1 for spyer activation (automatic in MemoryCheck replay)
// - use export CATCGMSpecialHandler=2 for spyer activation and traces
//
//==========================================================================
// 13/10/17 NLD Creation
// 18/10/17 NLD Split    de CATCGMSpecialHandler et creation de CATCGMSpecialHandlerSpyer
//              pour deport du spyer dans Mathematics afin de resoudre divers
//              problemes de link dans des frameworks utilisant les handlers CGM
//              sans declarer ce framework dans leur ImakeFile
//==========================================================================

//==========================================================================
#include &quot;ExportedByCATGMGeometricInterfaces.h&quot;
//==========================================================================

//==========================================================================
// Precompilation options
//==========================================================================
   #define CATCGMSpecialHandler_Available // &quot;En attente NLD161017&quot;

#ifdef     CATCGMSpecialHandler_Available
 #ifdef    _WINDOWS_SOURCE
   #define CATCGMSpecialHandler_Active
 #endif
#endif

//==========================================================================
// Macros declarations
//==========================================================================

#ifndef CATCGMSpecialHandler_Active
#include &quot;CATMacForIUnknown.h&quot; // standard macro definition for CATDeclareHandler and prerequisite
#define CATCGMSpecialHandlerDeclare(interfac,baseclass)   CATDeclareHandler(interfac,baseclass)
#define CATCGMSpecialHandlerImplement(interfac,baseclass) CATImplementHandler(interfac,baseclass)

#else

// remplacement de inline par CATCGMSpecialHandlerSpyerInline ?
// #define CATCGMSpecialHandlerSpyerInline
//-------------------------------------------------------------------------- HandlerSpecialDefinition_Begin
// spyer for a handler on a base class instance
// DO NOT USE DIRECTLY
// extern &quot;C&quot; ExportedByCATGMGeometricInterfaces
// void CATCGMSpecialHandlerSpyer(void* var, void *base);
#include &quot;CATCGMSpecialHandlerSpyer.h&quot;

// CATDeclareHandler(CATICGMUnknown,CATBaseUnknown);

// copy of WINDOWS implementation of macro  CATDeclareInlineAffect
/** @nodoc */
#define CATDeclareInlineAffectCGM(interfac)                                                        \
inline interfac##_var &amp; __stdcall operator=(const CATBaseUnknown *base);                           //

// - copy of WINDOWS implementation of macro  CATImplementInlineAffectCGM
// - ajout CATCGMSpecialHandlerSpyer
/** @nodoc */
#define CATImplementInlineAffectCGM(interfac)                                                      \
inline interfac##_var &amp; __stdcall interfac##_var::operator=(const CATBaseUnknown *base)            \
{                                                                                                  \
   __CastTo((IUnknown *)base);                                                                     \
   CATCGMSpecialHandlerSpyer(this, (void*)base);                                                   \
   return(*this);                                                                                  \
}                                                                                                  //

// - copy of WINDOWS implementation of macro  CATDeclareHandler
// - ajout CATCGMSpecialHandlerSpyer
/**
 * Declares a handler.
 * &lt;b&gt;Role&lt;/b&gt;: Declares a handler, or smart pointer, for an interface,
 * in the interface header file.
 * @param interfac
 *   Interface name
 * @param baseclass
 *   Class from which the interface class derives.
 */
#define CATCGMSpecialHandlerDeclare(interfac,baseclass)                                            \
                                                                                                   \
class interfac##_var : public baseclass##_var                                                      \
{                                                                                                  \
   private:                                                                                        \
      Exported void __stdcall __CastTo(IUnknown*pt);                                               \
   public:                                                                                         \
      inline ~interfac##_var();                                                                    \
      inline  interfac##_var();                                                                    \
      inline  interfac##_var(      CATBaseUnknown    *  base);                                     \
      inline  interfac##_var(      interfac          *  base);                                     \
      inline  interfac##_var(const interfac##_var     &amp; base);                                     \
      inline  interfac##_var(const CATBaseUnknown_var &amp; base);                                     \
      inline  interfac * __stdcall operator-&gt;() const;                                             \
      inline  __stdcall operator interfac *() const;                                               \
      inline  interfac##_var&amp; __stdcall operator=(const CATBaseUnknown_var &amp;base);                 \
      CATDeclareInlineAffectCGM(interfac)                                                          \
};                                                                                                 \
                                                                                                   \
inline interfac##_var::~interfac##_var()                                                           \
{                                                                                                  \
    CATCGMSpecialHandlerSpyer(this, NULL);                                                         \
}                                                                                                  \
inline interfac##_var::interfac##_var():baseclass##_var()                                          \
{                                                                                                  \
}                                                                                                  \
inline interfac##_var::interfac##_var(CATBaseUnknown *base) : baseclass##_var()                    \
{                                                                                                  \
    CATCGMSpecialHandlerSpyer(this, base);                                                         \
    __CastTo(base);                                                                                \
}                                                                                                  \
inline interfac##_var::interfac##_var(interfac *base):baseclass##_var((baseclass *)base)           \
{                                                                                                  \
    CATCGMSpecialHandlerSpyer(this, base);                                                         \
}                                                                                                  \
inline interfac##_var::interfac##_var(const interfac##_var &amp;base):baseclass##_var((baseclass*)base)\
{                                                                                                  \
    CATCGMSpecialHandlerSpyer(this, base);                                                         \
    __CastTo((CATBaseUnknown *)base);                                                              \
}                                                                                                  \
inline interfac##_var::interfac##_var(const CATBaseUnknown_var &amp;base): baseclass##_var()           \
{                                                                                                  \
    CATCGMSpecialHandlerSpyer(this, base);                                                         \
    __CastTo((IUnknown *)base);                                                                    \
}                                                                                                  \
inline interfac * __stdcall interfac##_var::operator-&gt;() const                                     \
{                                                                                                  \
    return((interfac *)CATBaseUnknown_var::operator-&gt;());                                          \
}                                                                                                  \
inline __stdcall interfac##_var::operator interfac *() const                                       \
{                                                                                                  \
    CATImplementConv(interfac);                                                                    \
}                                                                                                  \
inline interfac##_var&amp; __stdcall interfac##_var::operator=(const CATBaseUnknown_var &amp;base)         \
{                                                                                                  \
    CATCGMSpecialHandlerSpyer(this, base);                                                         \
    __CastTo((IUnknown *)base);                                                                    \
    return(*this);                                                                                 \
}                                                                                                  \
CATImplementInlineAffectCGM(interfac)                                                              \
                                                                                                   \
typedef interfac *interfac##_ptr                                                                   //


#define CATCGMSpecialHandlerImplement(interfac,baseclass)                                          \
void interfac##_var::__CastTo(IUnknown*pt)                                                         \
{                                                                                                  \
   CastTo(pt,IID_##interfac);                                                                      \
}                                                                                                  //


//-------------------------------------------------------------------------- HandlerSpecialDefinition_End
#endif

#endif
</div>
    
    <div class="navigation">
        <div><a href="CATCGMOperatorDebug.html">‚Üê ‰∏ä‰∏ÄÈ°µ: CATCGMOperatorDebug.h</a></div>
        <div><a href="CATCGMStream.html">‰∏ã‰∏ÄÈ°µ: CATCGMStream.h ‚Üí</a></div>
    </div>
</body>
</html>