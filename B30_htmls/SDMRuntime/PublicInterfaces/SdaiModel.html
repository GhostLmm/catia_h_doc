<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SDMRuntime/PublicInterfaces/SdaiModel.h</title>
    <style>
        body {
            font-family: 'Consolas', 'Monaco', monospace;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .header {
            background-color: #2c3e50;
            color: white;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        .navigation {
            display: flex;
            justify-content: space-between;
            margin: 15px 0;
            padding: 10px;
            background-color: #ecf0f1;
            border-radius: 5px;
        }
        .navigation a {
            color: #2980b9;
            text-decoration: none;
            padding: 5px 10px;
            background-color: white;
            border-radius: 3px;
            border: 1px solid #bdc3c7;
        }
        .navigation a:hover {
            background-color: #3498db;
            color: white;
        }
        .content {
            background-color: white;
            padding: 20px;
            border-radius: 5px;
            border: 1px solid #bdc3c7;
            white-space: pre-wrap;
            font-size: 14px;
            line-height: 1.4;
            overflow-x: auto;
        }
        .back-to-index {
            text-align: center;
            margin: 15px 0;
        }
        .back-to-index a {
            color: #27ae60;
            text-decoration: none;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>SDMRuntime/PublicInterfaces/SdaiModel.h</h1>
    </div>
    
    <div class="navigation">
        <div><a href="SdaiMacro.html">‚Üê ‰∏ä‰∏ÄÈ°µ: SdaiMacro.h</a></div>
        <div><a href="SdaiModelContents.html">‰∏ã‰∏ÄÈ°µ: SdaiModelContents.h ‚Üí</a></div>
    </div>
    
    <div class="back-to-index">
        <a href="index.html">üìÅ ËøîÂõûÁõÆÂΩï</a>
    </div>
    
    <div class="content">/**
 * @quickReview LDI 02:06:21
 */
// COPYRIGHT DASSAULT SYSTEMES  2001
#ifndef	_SDAI_MODEL_H_
#define	_SDAI_MODEL_H_

/**
 * @CAA2Level L1
 * @CAA2Usage U1
 */

#include &quot;KS0LATE.h&quot;

// ------------------------------------------------------------------------------------------------
// SDAI -- C++ Language Binding -- SdaiModel
// ------------------------------------------------------------------------------------------------
// Auteurs :
//	Corinne  VANDAELE (fevrier 1996)
// ------------------------------------------------------------------------------------------------
//  Historique :
//
//	MODIFICATION	: 00
//	DATE		: fevrier 1996
//	AUTEUR		: CVE
//	NATURE		: Creation
//	DESCRIPTION	: Norme ISO 10303-22 (binding C++)
// ------------------------------------------------------------------------------------------------

#include &quot;SdaiMacro.h&quot;
#include &quot;SdaiSessionInstance.h&quot;
#include &quot;SdaiString.h&quot;
#include &quot;CATCollec.h&quot;
#include &quot;SdaiModelContents.h&quot;

class CATSdaiModel;
class SdaiBoolean;
class SdaiSet;
class SdaiList;
class SdaiSchema;
class SdaiModelContents;
class SdaiRepo;
class SdaiEntity;
class SdaiGlobalRule;
class SdaiEntityExtents;
class SdaiEntityInstance;
class SdaiUniquenessRule;
class CATSdaiViolationUR;
class SdaiModelVisitor;

//class CATHDICO (SdaiEntityInstance);
//class CATLISTP (SdaiEntityExtents);
class CATLISTP (SdaiUniquenessRule);
class CATLISTP (CATSdaiViolationUR);


//--------------------------------------------------------------------------------
// ModelType 
// enumeration permettant de connaitre les differents types de modele 
// disponible pour toutes les implementations SDAI
// Uniquement Versant et Ckm pour le moment
//--------------------------------------------------------------------------------
/** @nodoc */
typedef enum // ModelType
{
	CkmTL,     // CKM Repository Volatile 
	VersantTR, // Versant Repository Transactionnel
	RelTR      // SGBDR Repository Transactionnel
} ModelType ;

// ------------------------------------------------------------------------------------------------
// Definition :
//
//      &#x27;SdaiModel&#x27; represente un ensemble d&#x27;instances correspondant a un schema donne
//
//      &#x27;SdaiModel&#x27; est le super-type de SdaiMOModel, SdaiTLModel et SdaiTRModel dont les
//	definitions restent mysterieuses dans la norme SDAI actuelle
//
// ------------------------------------------------------------------------------------------------
// Definition EXPRESS :
//
//ENTITY   sdai_model
//
//	underlying_schema : schema_definition ;	    (* Schema definissant la structure des donnees du modele *)
//	name		  : STRING ;		    (* Nom du modele *)
//	mode		  : OPTIONAL access_type ;  (* Mode courant d&#x27;acces au modele *)
//	contents	  : sdai_model_contents ;   (* Instances et Extents du modele, c.a.d. les donnees *)
//	rep		  : sdai_repository ;	    (* Repository auquel appartient le modele *)
//      manager           : SET OF sdai_manager;
//
//UNIQUE
//	UR1		  : rep, name ;		    (* Le nom d&#x27;un modele doit etre unique dans un repository *)
//
//END_ENTITY ;
//
// ------------------------------------------------------------------------------------------------

/**
 * Class representing a set of SDAI instances corresponding to a given schema.
 */
class ExportedByKS0LATE SdaiModel : public SdaiSessionInstance
{
  friend class CATSdaiRepo;
  friend class SdaiRepoContents;
  friend class SdaiRepo;
  friend class CATSdaiTRSModelDeleting;

  
	/* **************************************************************************************/
	/* C O N S T R U C T O R S								*/
	/* D E S T R U C T O R S								*/
	/* **************************************************************************************/
/** @nodoc */
	SdaiModel ( const SdaiModel&amp; ) ;
/** @nodoc */
	SdaiModel&amp; operator= ( const SdaiModel&amp; ) ;
public:
 void release();
protected:
/** @nodoc */
	SdaiModel ( ) ;

	// constructeur d&#x27;un modele valide
/** @nodoc */
	SdaiModel ( const SdaiSchemaH&amp;   sch_def,
		    const SdaiString&amp;    mdl_name,
		    const SdaiAccessMode mode,
		    SdaiModelContentsH&amp;  contents,
		    const SdaiAttrFlag   mode_flag = sdaiUNSET ) ;

	 virtual  ~SdaiModel ( ) ;          //bcc: the virtual is inherited in any case but let&#x27;s make it obvious

	// ****************************************************************************************
	// A C C E S    F U N C T I O N    D E C L A R A T I O N S
	// ****************************************************************************************
public :
    /**
     * @nodoc
     * sends a visitor to iterate over all the EntityExtents and selected instances.
     * the Visitor will be called on the VisitExtent method for each extent and depending on the
     * return value it will be called on VisitInstance on each instance of this extent.
     * The visit can be stopped at any instance using the return value of VisitInstance.
     * @param iVisitor, the visitor to be accepted
     * @return 0 if the iteration was aborted due to the return value of a call to VisitInstance, 
     * 1 otherwise.
     */
    inline int acceptModelVisitor(SdaiModelVisitor * iVisitor) const
    {
        return Contents()-&gt;acceptModelVisitor(iVisitor);
    }
	/**
    * Gets the SdaiSchema corresponding to a SdaiModel.
    */
	const SdaiSchemaH		Underlying_schema	()	const ;
/** @nodoc */
	const SdaiBoolean &amp;		TestUnderlying_schema	()	const ;

	/**
    * Gets the name of a SdaiModel.
	*  @return - the name of the model
    */
	const SdaiString  &amp;		Name			()	const ;
/** @nodoc */
	const SdaiBoolean &amp;		TestName		()	const ;

/** @nodoc */
	const SdaiAccessMode		Mode			()	const ;
/** @nodoc */
	const SdaiBoolean &amp;		TestMode		()	const ;

/** @nodoc */
	const SdaiModelContentsH 	Contents		()	const ;
/** @nodoc */
	const SdaiBoolean &amp;		TestContents		()	const ;

/** @nodoc */
	const SdaiRepoH			Repo			()	const ;
/** @nodoc */
	const SdaiBoolean &amp;		TestRepo		()	const ;

/** @nodoc */
	const SdaiString  &amp;		SchemaName		()	const ;	// Ajout BLC
/** @nodoc */
	const SdaiBoolean &amp;		TestSchemaName		()	const ;	// Ajout BLC

	// ****************************************************************************************
	// S D A I    O P E R A T I O N    D E C L A R A T I O N S
	// ****************************************************************************************
public :
	// Changer le nom du modele &#x27;this&#x27;
/** @nodoc */
	void	RenameModel		( const SdaiString&amp; ) ;

	/**
    * Closes a SdaiModel
    */
	virtual	void	CloseModel( ) = 0 ;

	// Rendre permanentes les changements faits dans le modele &#x27;this&#x27;
/** @nodoc */
	virtual	void	SaveChanges( )	= 0 ;

	// Annuler tous les changements faits dans au modele &#x27;this&#x27; depuis le dernier Load/Save
/** @nodoc */
	virtual	void	UndoChanges( )	= 0 ;

	// Retrouver toutes les instances d&#x27;une entite et de ses sous-types dans le modele &#x27;this&#x27;
	// attention signature differente de la norme (ajout CVE)
	// ( BLC le 23/01/95 : temporairement mis en virtual pour DRL en attendant )
	// (		     d&#x27;avoir la notion de modle dans les repositories CDM )
	/** @nodoc
    * Gets all instances of a given type (and its sub types) in a SdaiModel.
	*  @return - the list of SdaiEntityInstance
    */
 	virtual const	SDAIAGGRH(SdaiSet,SdaiEntityInstanceH)	GetEntityExtent	( const SdaiString&amp; )	const ; 
/** @nodoc */
	virtual const	SDAIAGGRH(SdaiSet,SdaiEntityInstanceH)	GetEntityExtent	( SdaiEntityH&amp; )  const ;

	// Petit utilitaire simplifiant les methodes GetEntityExtent et GetVolatileExtent
/** @nodoc */
	int GetRankInSchema (const SdaiSchemaH&amp; sch) const;

	// Retrouve toutes les instances d&#x27;une entite et de ses sous-types dans le modele &#x27;this&#x27;
	// L&#x27;aggregat passe en argument (et qu&#x27;on retrouve modifie en sortie) est &#x27;volatile&#x27;,
	// il n&#x27;est pas mis a jour lorsqu&#x27;on cree ou lorsqu&#x27;on detruit de nouvelles instances.
	// Cela permet d&#x27;acceder (momentanement) aux instances de l&#x27;entite
/** @nodoc */
	virtual void    GetVolatileExtent (SdaiEntityH&amp; entity, SDAIAGGRH(SdaiSet,SdaiEntityInstanceH)&amp; set_of_instances);

	// Permet de supprimer tous les aggregats (ceux associes a l&#x27;entite et a ses supertypes)
	// crees lors d&#x27;un precedent GetEntityExtent.
	// Une fois la methode ReleaseExtent appelee, on peut acceder a l&#x27;ensemble des instances
	// associees a l&#x27;entite &#x27;entity&#x27; par la methode GetVolatileExtent.
/** @nodoc */
	virtual void	ReleaseExtent (SdaiEntityH&amp; entity);


	// Retrouver la definition d&#x27;une entite appartenant au model &#x27;this&#x27;
	/**
    * Gets the definition of a type as an entity in a SdaiModel.
	*  @param - The type to describe
	*  @return - The SdaiEntity 
    */
	const  SdaiEntityH            GetEntityDefinition     ( const SdaiString&amp; )   const ;

	// Verifier qu&#x27;une regle globale est verifiee sur toutes les instances d&#x27;entite de &#x27;this&#x27;
/** @nodoc */
	const SdaiLogical&amp;	ValidateGlobalRule ( const SdaiGlobalRuleH&amp; )	const ; 

        /* determine si l&#x27;instance est d&#x27;un type appele typeName ou de l&#x27;un de ses sous-types */
/** @nodoc */
	virtual const SdaiBoolean &amp;   IsKindOf( const SdaiString&amp; iTypeName )  const; // &quot;Model&quot;

        // ajout LBR
	// Uniqueness rule : validation  regle entre 2 modeles
        // ( les instances des 2 modeles sont-elles compatibles ? )
//	const SdaiLogical&amp;	CompareModelInstances ( const SdaiModelH,
//                                                        const SdaiEntityH,
//                                         const SDAIAGGRH(SdaiList,SdaiAttrH) )	const ; 

        // Uniqueness rule : validation globale au sein du modele
        // Remplace le ValidateUniquenessRule qui doit normalement
        // se trouver dans SdaiAppInstance.
/** @nodoc */
	const SdaiLogical&amp; 
	    ValidateUniquenessRule (const SdaiUniquenessRuleH&amp;);

        // Retrouve la liste de tous les UniquenessRules du modele
/** @nodoc */
	    CATLISTP(SdaiUniquenessRule) * GetAllUniquenessRules ();

        // Retrouve une violation a partir de la definition d&#x27;un
        // Uniqueness Rule
/** @nodoc */
           CATSdaiViolationUR * GetViolation (const SdaiUniquenessRuleH&amp;);

        // Retrouve l&#x27;ensemble des violations (contenant une liste d&#x27;anomalies
        // non vide) sous forme d&#x27;une liste de pointeurs 
/** @nodoc */
	   CATLISTP(CATSdaiViolationUR) * GetAllViolationsUR ();


        // Retrouve l&#x27;Entity Extent associee a une entite donnee
/** @nodoc */
	    SdaiEntityExtentsH GetExtent (const SdaiEntityH&amp;); 

	// ****************************************************************************************
	// D S    O P E R A T I O N    D E C L A R A T I O N S
	// ****************************************************************************************
public :
        // Abonnements / Desabonnements aux classes   (ajout d&#x27;evenements sur classes (projet mbd)) 
/** @nodoc */
	void AddCallback ( SdaiEventId evt,
			   SdaiRootH ToCall,
			   WakeUpFonction Fonc,
			   const SdaiString&amp; ClassName,
			   const SdaiString&amp; AttrName = NULL_SDAI_STRING);

/** @nodoc */
	void RemoveCallback ( SdaiEventId evt,
			      SdaiRootH ToCall,
			      WakeUpFonction Fonc,
			      const SdaiString&amp; ClassName,
			      const SdaiString&amp; AttrName = NULL_SDAI_STRING);

        // Recuperer l&#x27;Uuid d&#x27;un model
/** @nodoc */
	int Uuid(unsigned char u_bits[16]);
	
	// Recuperer le Relative Name d&#x27;une AppInstance
/** @nodoc */
	virtual int GetAppRelativeName ( const SdaiAppInstanceH Instance,
					 const void * &amp; RelativeName,
					 int &amp; NbBytes) const ;
					 
	// Recuperer un Hint sur une AppInstance pour la construction de liens symboliques
/** @nodoc */
	virtual int GetSLinkHint ( const SdaiAppInstanceH Instance,
				   const void * &amp; Hint,
				   int &amp; NbBytes) const ;					 
	
	// Savoir si un modele a ete modifie (1 modifie, 0 non modifie)
	/**
    * Tests if a SdaiModel has been modified
	*  @return 1 if Model has changed, 0 else. 
    */
	int  IsChanged() const;

	// Remettre a 0 le flag de modification du model
/** @nodoc */
	int  ResetChange();
 
 	// ****************************************************************************************
	// D S    O P E R A T I O N    (public but private)
	// ****************************************************************************************
        // Connaitre le type d&#x27;un modele
//        virtual ModelType   GetModelType()	const	= 0 ;

/** @nodoc */
        inline CATSdaiModel * Model() const { return _Model; }

	// ****************************************************************************************
	// I M P L E M E N T A T I O N
	// ****************************************************************************************

#ifdef SDAI_MULTI_TRANS_BCC
  /**
   * This is used to determine if this SdaiModel has Copy-On-Write enabled.
   */
  SdaiRoot::COWSupport COWing() const;
/** @nodoc */
  void enableCOW();
/** @nodoc */
  void disableCOW();
/** @nodoc */
  void ConfirmExtents();
#endif
protected :
	// Pointeur sur implementation
/** @nodoc */
        CATSdaiModel * _Model;


} ;

#endif	/* _SDAI_MODEL_H_ */

</div>
    
    <div class="navigation">
        <div><a href="SdaiMacro.html">‚Üê ‰∏ä‰∏ÄÈ°µ: SdaiMacro.h</a></div>
        <div><a href="SdaiModelContents.html">‰∏ã‰∏ÄÈ°µ: SdaiModelContents.h ‚Üí</a></div>
    </div>
</body>
</html>