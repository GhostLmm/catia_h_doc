<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>System/PublicInterfaces/CATError.h</title>
    <style>
        body {
            font-family: 'Consolas', 'Monaco', monospace;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .header {
            background-color: #2c3e50;
            color: white;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        .navigation {
            display: flex;
            justify-content: space-between;
            margin: 15px 0;
            padding: 10px;
            background-color: #ecf0f1;
            border-radius: 5px;
        }
        .navigation a {
            color: #2980b9;
            text-decoration: none;
            padding: 5px 10px;
            background-color: white;
            border-radius: 3px;
            border: 1px solid #bdc3c7;
        }
        .navigation a:hover {
            background-color: #3498db;
            color: white;
        }
        .content {
            background-color: white;
            padding: 20px;
            border-radius: 5px;
            border: 1px solid #bdc3c7;
            white-space: pre-wrap;
            font-size: 14px;
            line-height: 1.4;
            overflow-x: auto;
        }
        .back-to-index {
            text-align: center;
            margin: 15px 0;
        }
        .back-to-index a {
            color: #27ae60;
            text-decoration: none;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>System/PublicInterfaces/CATError.h</h1>
    </div>
    
    <div class="navigation">
        <div><a href="CATErrParams.html">‚Üê ‰∏ä‰∏ÄÈ°µ: CATErrParams.h</a></div>
        <div><a href="CATErrorDef.html">‰∏ã‰∏ÄÈ°µ: CATErrorDef.h ‚Üí</a></div>
    </div>
    
    <div class="back-to-index">
        <a href="index.html">üìÅ ËøîÂõûÁõÆÂΩï</a>
    </div>
    
    <div class="content">// COPYRIGHT DASSAULT SYSTEMES 2003
#ifndef CATERROR_H
#define CATERROR_H

// COPYRIGHT DASSAULT SYSTEMS 1999

/**
 * @CAA2Level L1
 * @CAA2Usage U2
 */

//-----------------------------------------------------------------------------
// Abstract:	Base abstract class for error handling
//-----------------------------------------------------------------------------
// Usage:	This base abstract class implements all the required methods
//		The only method to be redefined is GetErrorTable which returns
//		a pointer to a table containing all the errors pertaining to
//		this class: this is automatically done by the msgp processor
//-----------------------------------------------------------------------------

#include &lt;string.h&gt;
#include &quot;CATErrorDefs.h&quot;
#include &quot;CATErrDsc.h&quot;
#include &quot;CATErrParams.h&quot;
#include &quot;CATUnicodeString.h&quot;
#include &quot;CATAssert.h&quot;

#ifndef _WINDOWS_SOURCE
#include &quot;IErrorInfo.h&quot;
#else 
#include &quot;oaidl.h&quot;
#include &quot;oleauto.h&quot;
#endif

// Error Key Format in message catalogue
// -------------------------------------
/** @nodoc */
#define MSG_CLE_PREFIX            &quot;ERR_&quot;    
/** @nodoc */
#define MSG_CLE_SUFFIX            &quot;.&quot;
/** @nodoc */
#define MSG_CLE_SEPARATOR         &quot;_&quot;
/** @nodoc */
#define MSG_CLE_SUFFIX_ACTION     &quot;.Request&quot;	
/** @nodoc */
#define MSG_CLE_SUFFIX_CAUSE      &quot;.Diagnostic&quot;
/** @nodoc */
#define MSG_CLE_SUFFIX_SOLUTION   &quot;.Advice&quot;

// CATError Return Macros: Specify generic return code for method
// --------------------------------------------------------------
// return ok
/**
 * Method successful return code.
 * &lt;br&gt;&lt;b&gt;Role&lt;/b&gt;: Use it to successfully return from a method using the error manager.
 */
#define CATReturnSuccess             CATError::GetReturn(1,NULL,NULL,__FILE__,__LINE__) // S_OK

// return failed without a CATError
/**
 * Method failing return code.
 * &lt;br&gt;&lt;b&gt;Role&lt;/b&gt;: Use it to unsuccessfully return from a method using the error manager.
 */
#define CATReturnFailure             CATError::GetReturn(0,NULL,NULL,__FILE__,__LINE__) //E_UNEXPECTED

// return failed with a CATError
/**
 * Method failing return code returning an error class instance.
 * &lt;br&gt;&lt;b&gt;Role&lt;/b&gt;: Use it to unsuccessfully return from a method using the error manager,
 * if you want to associate the failure with an error class instance.
 */
#define CATReturnError(iptCATError)  CATError::GetReturn(2,iptCATError,NULL,__FILE__,__LINE__)

// CATError types
// --------------
/**
 * Error type.
 * @param CATErrorTypeCritical
 *   Critical error.
 *   A problem occurs that the method cannot handle.
 *   It returns as soon as the problem occurs.
 *   This is the default
 * @param CATErrorTypeFatal
 *   Fatal error.
 *   A problem occurs that the method cannot handle.
 *   It stops with no possible recovery.
 * @param CATErrorTypeWarning
 *   Warning.
 *   Something happens that doesn&#x27;t stop the method.
 *   It completes and returns a warning.
 * @param CATErrorTypeInformation
 *   Information.
 *   The method successively completes.
 *   It returns information that can be handy
 */
enum CATErrorType { CATErrorTypeCritical = 1,
                    CATErrorTypeFatal = 2,
                    CATErrorTypeWarning = 3,
                    CATErrorTypeInformation = 4};

#if defined(_AIX_SOURCE) &amp;&amp; (__xlC__ &gt;= 0x0500)
class CATError;
    /**
     * Delete error chain.
     * @param errorPtr
     *   The first error to delete in the error chain
     */
    extern ExportedByJS0ERROR void Flush (CATError* errorPtr);
#endif

//
// Abstract root class of all errors
//
/**
 * Base class for errors.
 * &lt;b&gt;Role&lt;/b&gt;:
 * You cannot instantiate this class.
 * Derive it to create your own error class that refines the type of managed errors  using
 * @href CATDeclareError and @href CATImplementError macros.
 * 
 */
class ExportedByJS0ERROR CATError : public CATBaseUnknown {

  public:
    /**
     * Delete error chain.
     * @param errorPtr
     *   The first error to delete in the error chain
     */
    friend ExportedByJS0ERROR void Flush (CATError* errorPtr);

    // Constructor 
    // -----------
	/**
	 * Constructs an error with a given error identifier and a given message.
	 * @param iMsgId
	 *   The message key
	 * @param iMsgCatalog
	 *   The message catalog in which the message is located
	 */
    CATError ( const char * iMsgId , const char * iMsgCatalog  );
	/** @nodoc */
    CATError (CATErrorId iId);
	/** @nodoc */
    CATError (CATErrorId iId, const char * iMsgId, const char * iMsgCatalog = NULL);
	/** @nodoc */
    CATError (const CATError &amp; iError);

    // Destructor
    // ----------
    virtual ~CATError ();

    // General Information
    // -------------------
	/**
	 * Returns the error identifier.
	 */
    virtual CATErrorId GetId ();          // return the error id 
	/**
	 * Returns the error message key.
	 */
    virtual const char *GetMsgId ();      // return the message Id ( message key )
	/**
	 * Returns the error message catalog file name.
	 */
    virtual const char *GetMsgCatalog (); // return the message catalog
	/** @nodoc */
    const char *GetName ();               // reserved
    
    // File information where the error occurred
    // -----------------------------------------
	/**
	 * Retrieves the source file path name where the error occurs.
	 * @param oFile
	 *   The source file path name.
	 *   &lt;br&gt;&lt;b&gt;Lifecycle rules deviation&lt;/b&gt;: Do not delete this pointer.
	 * @return
	 *   An HRESULT.
	 *   &lt;dl&gt;
	 *     &lt;dt&gt;S_OK    &lt;dd&gt;The source file path name is successively retrieved
	 *     &lt;dt&gt;E_FAIL  &lt;dd&gt;The source file path name can&#x27;t be retrieved
	 *   &lt;/dl&gt;
	 */
    virtual HRESULT GetSourceFileName(  char** oFile );
	/**
	 * Sets the source file path name where the error occurs.
	 * @param iFile
	 *   The source file path name
	 * @return
	 *   An HRESULT.
	 *   &lt;dl&gt;
	 *     &lt;dt&gt;S_OK    &lt;dd&gt;The source file path name is successively set
	 *     &lt;dt&gt;E_FAIL  &lt;dd&gt;The source file path name can&#x27;t be set
	 *   &lt;/dl&gt;
	 */
    virtual HRESULT SetSourceFileName(  char* iFile );

	/**
	 * Retrieves the line number in the source file where the error occurs.
	 * @param oLine
	 *   The line number
	 * @return
	 *   An HRESULT.
	 *   &lt;dl&gt;
	 *     &lt;dt&gt;S_OK    &lt;dd&gt;The line number is successively retrieved
	 *     &lt;dt&gt;E_FAIL  &lt;dd&gt;The line number can&#x27;t be retrieved
	 *   &lt;/dl&gt;
	 */    
    virtual HRESULT GetSourceLineNumber(  int *oLine );
	/**
	 * Sets the line number in the source file where the error occurs.
	 * @param iLine
	 *   The line number
	 * @return
	 *   An HRESULT.
	 *   &lt;dl&gt;
	 *     &lt;dt&gt;S_OK    &lt;dd&gt;The source file path name is successively set
	 *     &lt;dt&gt;E_FAIL  &lt;dd&gt;The source file path name can&#x27;t be set
	 *   &lt;/dl&gt;
	 */
    virtual HRESULT SetSourceLineNumber(  int iLine );
    
    
    // Get Errors messages
    // ------------------------------
	/** @nodoc */
    virtual const char *GetMessageText (int longMessage = 0); 	//reserved

   	/**
	 * Returns the error message.
	 * &lt;br&gt;&lt;b&gt;Role&lt;/b&gt;: The three parts Request, Diagnostic, and Advice
	 * of the error message are returned concatenated in a single message.
	 */
    virtual CATUnicodeString GetNLSMessage ();
   	/**
	 * Returns the Request part of the error message.
	 */
    virtual CATUnicodeString GetNLSRequest ();
   	/**
	 * Returns the Diagnostic part of the error message.
	 */
    virtual CATUnicodeString GetNLSDiagnostic ();
   	/**
	 * Returns the Advice part of the error message.
	 */
    virtual CATUnicodeString GetNLSAdvice ();

   	/**
	 * Returns the error source.
	 * &lt;br&gt;&lt;b&gt;Role&lt;/b&gt;: The error source is made of the concatenation of:
	 * &lt;ul&gt;
	 * &lt;li&gt;the source context. It is the name of the application
	 * that issues the error, usually CATIA
	 * &lt;li&gt;the error message catalog file name
	 * &lt;li&gt;the error message key in the error message catalog
	 * &lt;/ul&gt;
	 * They are separated with the &quot;-&quot; (dash) character.
	 * &lt;br&gt;Example: CATIA - SystemError - KeyRangeERR_3000 
	 */
    virtual CATUnicodeString GetNLSSource ();
   	/** @nodoc */
    virtual CATUnicodeString GetNLSHelpFile ();
	/** @nodoc */
    virtual DWORD GetNLSHelpContext ();  

        
    // outputs one the error messages
	/** @nodoc */
    virtual void Display ();
    // output the error history
	/** @nodoc */
    virtual void PrintHistory ();
    // Throw
	/** @nodoc */
    virtual void Throw (const char *loc, int line, void *ptr_to_delete = NULL);
    
    // Set the error message parameters
    // --------------------------------
	/** @nodoc */
    void SetParameters (int numIParams, int I1, ...);		//reserved
	/** @nodoc */
    void SetParameters (int numRParams, double R1, ...);	//reserved
	/** @nodoc */
    void SetParameters (int numCParams, const char *C1, ...);	//reserved
    /**
	 * Sets the values of the error message parameters.
	 * &lt;br&gt;&lt;b&gt;Role&lt;/b&gt;: The error message can contain parameters that are valued at run time
	 * when the error occurs.
	 * Their values must first be converted as CATUnicodeString instances.
	 * This method has a variable number of parameters to match the error message
	 * parameter number.
	 * Use this method for a non-composite error message, that is, an error message without
	 * Request, Diagnostic, and Advice parts.
	 * @param iNumNLSParam
	 *   The number of parameters of the error message
	 * @param iUS1
	 *   The first parameter value converted as a CATUnicodeString instance
     */
    virtual void SetNLSParameters (int iNumNLSParam, CATUnicodeString * iUS1, ...);
    /**
	 * Sets the values of the Request part of the error message parameters.
	 * &lt;br&gt;&lt;b&gt;Role&lt;/b&gt;: The Request part of error message can contain parameters
	 * that are valued at run time when the error occurs.
	 * Their values must first be converted as CATUnicodeString instances.
	 * This method has a variable number of parameters to match the error message
	 * parameter number.
	 * @param iNumNLSParam
	 *   The number of parameters of the error message
	 * @param iUS1
	 *   The first parameter value converted as a CATUnicodeString instance
     */
    virtual void SetNLSRequestParams (int iNumNLSParam, CATUnicodeString * iUS1, ...);
    /**
	 * Sets the values of the Diagnostic part of the error message parameters.
	 * &lt;br&gt;&lt;b&gt;Role&lt;/b&gt;: The Diagnostic part of error message can contain parameters
	 * that are valued at run time when the error occurs.
	 * Their values must first be converted as CATUnicodeString instances.
	 * This method has a variable number of parameters to match the error message
	 * parameter number.
	 * @param iNumNLSParam
	 *   The number of parameters of the error message
	 * @param iUS1
	 *   The first parameter value converted as a CATUnicodeString instance
     */
    virtual void SetNLSDiagnosticParams (int iNumNLSParam, CATUnicodeString * iUS1, ...);
    /**
	 * Sets the values of the Advice part of the error message parameters.
	 * &lt;br&gt;&lt;b&gt;Role&lt;/b&gt;: The Advice part of error message can contain parameters
	 * that are valued at run time when the error occurs.
	 * Their values must first be converted as CATUnicodeString instances.
	 * This method has a variable number of parameters to match the error message
	 * parameter number.
	 * @param iNumNLSParam
	 *   The number of parameters of the error message
	 * @param iUS1
	 *   The first parameter value converted as a CATUnicodeString instance
     */
    virtual void SetNLSAdviceParams (int iNumNLSParam, CATUnicodeString * iUS1, ...);

	/**
	 * Sets the source context.
	 * &lt;br&gt;&lt;b&gt;Role&lt;/b&gt;: The source context is the name of the application
	 * that issues the error. It is CATIA by default.
	 * @param icontext
	 *   The source context
	 * @return
	 *   An HRESULT.
	 *   &lt;dl&gt;
	 *     &lt;dt&gt;S_OK    &lt;dd&gt;The source context is successively set
	 *     &lt;dt&gt;E_FAIL  &lt;dd&gt;The source context can&#x27;t be set
	 *   &lt;/dl&gt;
	 */
    virtual HRESULT SetSourceContext( char *icontext );
	/**
	 * Retrieves the source context.
	 * &lt;br&gt;&lt;b&gt;Role&lt;/b&gt;: The source context is the name of the application
	 * that issues the error.
	 * @param ocontext
	 *   The source context.
	 *   &lt;br&gt;&lt;b&gt;Legal values&lt;/b&gt;: It is CATIA by default.
	 * @return
	 *   An HRESULT.
	 *   &lt;dl&gt;
	 *     &lt;dt&gt;S_OK    &lt;dd&gt;The source context is successively retrieved
	 *     &lt;dt&gt;E_FAIL  &lt;dd&gt;The source context can&#x27;t be retrieved
	 *   &lt;/dl&gt;
	 */ 
    virtual HRESULT GetSourceContext( char **ocontext );
        
    // HRESULT management 
    // ------------------
	/**
	 * Returns the error return code for error propagation.
	 * &lt;br&gt;&lt;b&gt;Legal values&lt;/b&gt;: Valid HRESULT values.
	 */
    virtual HRESULT GetReturnCode();		// Return a COM compatible HRESULT :default E_FAIL
	/**
	 * Sets the error return code for error propagation.
	 * &lt;br&gt;&lt;b&gt;Role&lt;/b&gt;: Replaces the default return code (E_FAIL).
	 * This return code is used when the error needs to be propagated, that is,
	 * when the method in error returns using the @href CATReturnError macro.
	 * @param iHRESULTCode
	 *   The error code.
	 *   &lt;br&gt;&lt;b&gt;Legal values&lt;/b&gt;: It must be a valid HRESULT value.
	 */
    virtual void SetReturnCode(HRESULT iHRESULTCode);	// Modify HRESULT
    
    // Error type
    // ----------
	/**
	 * Returns the error type.
	 */
    virtual CATErrorType GetInformationOnErrorType ();            // Return the Error type : default Critical
	/**
	 * Sets the error type.
	 * @param iErrorType
	 *   The error type to set to the error
	 */
    virtual HRESULT SetInformationOnErrorType( CATErrorType iErrorType);    // Modify the Error type 
   
    // Errors Management
    // -----------------
    // Gets the CATError pointer set by CATSetLastError
	/**
	 * Returns a pointer to the last error class instance.
	 * @param iHR
	 *   The return code of the method in error
	 * @param iInterfaces
	 *   The pointer to the interface used to call the method in error.
	 *   &lt;br&gt;&lt;b&gt;Legal values&lt;/b&gt;: Set it to NULL in case of non-distribution, and
	 *   to the interface pointer used to call the method otherwise. 
	 */
    static CATError* CATGetLastError ( HRESULT iHR, IUnknown *iInterfaces = NULL );
    
    // Release the current CATError if one exists
	/**
	 * Cleans the last returned error.
	 * &lt;br&gt;&lt;b&gt;Role&lt;/b&gt;: Deletes the last returned error instance and cleans
	 * the error manager.
	 */
    static void CATCleanLastError ( );  
     
    // Sets the CATError pointer. Do not use this directly, use CATError Return Macros
	/**
	 * Sets the error to return.
	 * &lt;br&gt;&lt;b&gt;Role&lt;/b&gt;: Once you have created the error class instance in the method in error,
	 * use CATSetLastError to pass it to the error manager. The error can then be retrieved
	 * by the caller using @href #CATGetLastError
	 * @param iInterfaces
	 *   &lt;br&gt;&lt;b&gt;Legal values&lt;/b&gt;: Set it always to NULL
	 */
    void CATSetLastError (IUnknown *iInterfaces = NULL );
      
    // Internal Return Code Managment 
    // -----------------------------
	/** @nodoc */
    static HRESULT GetReturn ( int , CATError *ierr, IUnknown *iinterface, char *ifile, int iline );  //reserved
   
    // Internal COM Errors Management
    // ------------------------------
	/** @nodoc */
    IErrorInfo* SetErrorInfoFromCATError( IUnknown *iinterface ); //reserved
    
    // Internal bookeeping
    // -------------------
	/** @nodoc */
    static CATError *GetCurrentError ();
	/** @nodoc */
    static CATError *SetCurrentError (CATError *err);
	/** @nodoc */
    CATDeclareBaseErrorClass (CATError)
 
  protected:
     
    // Internal Error Manager
    // ----------------------
	/** @nodoc */
	static void SetLastCATError ( CATError* ierr );
	/** @nodoc */
    static CATError* GetLastCATError ( HRESULT ihr );
    
	/** @nodoc */
    CATErrorId ExtractCATErrorId( CATUnicodeString&amp; ); 
	/** @nodoc */
    const CATErrDsc *LookupEntry ();

	/** @nodoc */
    CATErrParams params;
	/** @nodoc */
    CATErrDsc   *tableEntry;
	/** @nodoc */
    CATError    *previousError;
	/** @nodoc */
    CATErrorId   id;
	/** @nodoc */
    int          lineno;
	/** @nodoc */
    char         message[128];
	/** @nodoc */
    char         filename[128];
	/** @nodoc */
    static CATError *currentError;
	/** @nodoc */
    static int   unwinding;
	/** @nodoc */
    CATString   *msgCatalog;
	/** @nodoc */
    CATString   *msgId;
	/** @nodoc */
    HRESULT    ReturnCode; 
	/** @nodoc */
    int          NLSParamCount;
	/** @nodoc */
    CATUnicodeString *NLSParams;
	/** @nodoc */
    CATUnicodeString *NLSParamsRequest;
	/** @nodoc */
    int          NLSParamCountRequest; /** @win64 fbq : 64-bit structure padding **/
	/** @nodoc */
    int          NLSParamCountDiagnostic;
	/** @nodoc */
    CATUnicodeString *NLSParamsDiagnostic;
	/** @nodoc */
    CATUnicodeString *NLSParamsAdvice;
	/** @nodoc */
    CATUnicodeString *msgcontext;
	/** @nodoc */
    int          NLSParamCountAdvice; /** @win64 fbq : 64-bit structure padding **/
    

 private:
    
    int msgtype;
    void         Init (CATErrorId iId, const char *imsgId,
		       const char *imsgCatalog);
    CATUnicodeString *comhelpfile;
    DWORD comhelpcontext;
    CATErrorType errtype;   
    char * sourcename;
};

	/** @nodoc */
ExportedByJS0ERROR
    void CATTerminate ();

	/** @nodoc */
ExportedByJS0ERROR
    CATTerminateFunction CATSetTerminate (CATTerminateFunction func);

#ifndef _WINDOWS_SOURCE
	/** @nodoc */
ExportedByJS0ERROR HRESULT SetErrorInfo ( long ival, IErrorInfo *iperrinfo );
	/** @nodoc */
ExportedByJS0ERROR HRESULT GetErrorInfo ( long ival, IErrorInfo**opperrinfo );
#endif
#endif
</div>
    
    <div class="navigation">
        <div><a href="CATErrParams.html">‚Üê ‰∏ä‰∏ÄÈ°µ: CATErrParams.h</a></div>
        <div><a href="CATErrorDef.html">‰∏ã‰∏ÄÈ°µ: CATErrorDef.h ‚Üí</a></div>
    </div>
</body>
</html>