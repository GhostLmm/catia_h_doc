<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DialogEngine/PublicInterfaces/CATEditAgent.h</title>
    <style>
        body {
            font-family: 'Consolas', 'Monaco', monospace;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .header {
            background-color: #2c3e50;
            color: white;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        .navigation {
            display: flex;
            justify-content: space-between;
            margin: 15px 0;
            padding: 10px;
            background-color: #ecf0f1;
            border-radius: 5px;
        }
        .navigation a {
            color: #2980b9;
            text-decoration: none;
            padding: 5px 10px;
            background-color: white;
            border-radius: 3px;
            border: 1px solid #bdc3c7;
        }
        .navigation a:hover {
            background-color: #3498db;
            color: white;
        }
        .content {
            background-color: white;
            padding: 20px;
            border-radius: 5px;
            border: 1px solid #bdc3c7;
            white-space: pre-wrap;
            font-size: 14px;
            line-height: 1.4;
            overflow-x: auto;
        }
        .back-to-index {
            text-align: center;
            margin: 15px 0;
        }
        .back-to-index a {
            color: #27ae60;
            text-decoration: none;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>DialogEngine/PublicInterfaces/CATEditAgent.h</h1>
    </div>
    
    <div class="navigation">
        <div><a href="CATDlgEngUtility.html">‚Üê ‰∏ä‰∏ÄÈ°µ: CATDlgEngUtility.h</a></div>
        <div><a href="CATICmdSwitchAgent.html">‰∏ã‰∏ÄÈ°µ: CATICmdSwitchAgent.h ‚Üí</a></div>
    </div>
    
    <div class="back-to-index">
        <a href="index.html">üìÅ ËøîÂõûÁõÆÂΩï</a>
    </div>
    
    <div class="content">#ifndef __CATEditAgent_h
#define __CATEditAgent_h
#include &quot;CATDialogEngine.h&quot;

// COPYRIGHT DASSAULT SYSTEMES 2000
// protected CATDegEditAgent.m

/**
 * @CAA2Level L1
 * @CAA2Usage U1
 */

#include &quot;CATStateCommand.h&quot;

#include &quot;CATBaseUnknown.h&quot;
#include &quot;CATBoolean.h&quot;
#include &quot;CATString.h&quot;
#include &quot;CATUnicodeString.h&quot;

class CATPathElement;
class CATFrmEditor;
class CATCommand;
class CATNotification;
class CATActiveObject;
class CATDialog;
class CATStackableCommandSet;
class CATDialogAgent;

/**
 * Class representing an agent to edit an object in a workbench different from the
 * current one.
 * &lt;b&gt;Role&lt;/b&gt;: An edition agent is a specific agent which enables the user to
 * edit an object inside a state command. This agent is itself a state command which,
 * when it is activated, launchs the workbench specified by the @href #SetWorkbench method. Once the end user has
 * clicked on the workbench&#x27;s exit button, the edition agent is completed, the edited object is put 
 * into the CSO, and the state chart of the original command resumes. 
 * &lt;br&gt;The object to edit is provided by a method given as argument of the
 * @href #SetElementProvider method.
 * &lt;br&gt;&lt;br&gt;&lt;b&gt;Note&lt;/b&gt;: As every state command used as an agent,
 * an edition agent must be the only agent added to a given state.
 */
class ExportedByCATDialogEngine CATEditAgent: public CATStateCommand
{

  /** @nodoc */
  CATDeclareClass;
  /** @nodoc */
  CmdDeclareResourceFile(CATDialogEngine, CATEditAgent, CATStateCommand);
  
public:
  
  /**
  * Constructs an edition agent.
  * @param iId
  *   The agent identifier. It is used to retrieve the undo/redo titles in 
  *   the command resource file.
  * @param iType
  *   The type corresponds to an interface. 
  *   &lt;br&gt;It is given to be an argument of the &lt;tt&gt;ElementProvider&lt;/tt&gt; method given 
  *   as argument of the @href #SetElementProvider method. This &lt;tt&gt;ElementProvider&lt;/tt&gt; 
  *   method can use or not this input parameter to check the object to edit.
  */
  CATEditAgent (const CATString &amp; iId,
                CATClassId iType=NULL);
  /**
  * @nodoc
  * OBSOLETE : Do not use
  */
  CATEditAgent (CATStateCommand * iFather,
                const CATString &amp; iId,
                CATFrmEditor * iEditor,
                CATClassId iType=NULL);

  virtual ~CATEditAgent ();

 /**
  * Prototype of the element provider methods.
  * &lt;br&gt;&lt;b&gt;Role&lt;/b&gt;: These methods are passed as parameters of the @href 
  * #SetElementProvider method and are automatically called each time the 
  * edition agent is activated. 
  * &lt;br&gt;They are expected to return a full model path element to be edited.
  * @param iType
  *   The type corresponds to an interface. 
  *   &lt;br&gt;&lt;tt&gt;iType&lt;/tt&gt; is an input parameter coming from the constructor 
  *   ( @href #CATEditAgent ). 
  * @return 
  *   The path to the object to edit. The object to activate is the first one
  *   implementing @href CATIUIActivate (beginning from the leaf).
  *   &lt;br&gt;&lt;b&gt;Cyclic reference&lt;/b&gt;: the path is kept and AddRef&#x27;ed.
  *   It is Released at the end of the agent before the agent
  */
  typedef CATPathElement * (CATBaseUnknown::*ElementProvider) (CATClassId iType);

  /**
  * Sets the method to provide the object to edit.
  * &lt;br&gt;&lt;b&gt;Role&lt;/b&gt;: This method enables you to specify the name of a 
  * &lt;tt&gt;ElementProvider&lt;/tt&gt; method, and an instance of the class defining this method. 
  * This &lt;tt&gt;ElementProvider&lt;/tt&gt; method will be called just before
  * the edition to provide to the agent the object to edit .
  * &lt;pre&gt;
  * _myAgent = new CATEditAgent(&quot;EditAgentId&quot;);
  * _myAgent-&gt;SetElementProvider(this, 
  *              (CATEditAgent::ElementProvider) &amp;MyStateCommand::&lt;tt&gt;ObjectProviderMethod&lt;/tt&gt;);
  * &lt;/pre&gt;
  * @param iObject
  *   The pointer to the class instance defining &lt;tt&gt;iMethod&lt;/tt&gt;
  * @param iMethod
  *   The method to execute before edition.
  */
  void SetElementProvider (CATBaseUnknown * iObject, ElementProvider iMethod);
  
  /**
  * Sets the workbench used during the edition.
  * &lt;br&gt;&lt;b&gt;Role&lt;/b&gt;: This method sets the name of the workbench that must be activated
  * to edit the object.
  * For workshops with only one workbench or without workbench (like Sketcher), this method 
  * is useless.
  * @param iWorkbench
  *   The workbench name
  */
  void SetWorkbench (const CATString &amp; iWorkbench);
  
  /**
  * Sets the commands available during the edition.
  * &lt;br&gt;&lt;b&gt;Role&lt;/b&gt;: This method enables you to specify the available
  * commands for the activated workbench. 
  * &lt;br&gt;If this method is never called, or if &lt;tt&gt;NULL&lt;/tt&gt; is given as argument,
  * an empty instance of the @href CATStackableCommandSet class will be used by
  * the agent. A minimum set of commands will then be available, including the one
  * to leave the workbench.
  * @param iCommandSet
  *   The command set.
  *   &lt;br&gt;&lt;b&gt;Cyclic reference&lt;/b&gt;: &lt;tt&gt;iCommandSet&lt;/tt&gt; is kept and AddRef&#x27;ed.
  *   It is Released at the end of the agent before the agent destructor call.
  */
  void SetCommandSet (CATStackableCommandSet * iCommandSet);
  
  /**
  * Sets the dialog object, if any, representing the command.
  * &lt;br&gt;&lt;b&gt;Role&lt;/b&gt;: This dialog object will be desactivated during the edition
  * (but it won&#x27;t be hidden by the edition agent) and reactivated after the edition.
  * @param iDialog
  *   The dialog object.
  */
  void SetPanel (CATDialog * iDialog);
    
  /**
  * Returns the path of the edited object.
  * &lt;br&gt;&lt;b&gt;Role:&lt;/b&gt;This method returns the value returned by the 
  * &lt;tt&gt;ElementProvider&lt;/tt&gt; method. Since this &lt;tt&gt;ElementProvider&lt;/tt&gt; method is
  * called just before the edition, the value is valid only after the edition. 
  * @return 
  *   The path of the edited object. 
  * &lt;br&gt;&lt;b&gt;Lifecycle rules deviation&lt;/b&gt;: This method doesn&#x27;t AddRef the 
  * returned value.
  */
  CATPathElement * GetValue ();
  
  /**
  * @nodoc
  * Specifies a user interaction expected by the agent before triggering the edition.
  * &lt;br&gt;&lt;b&gt;Role&lt;/b&gt;: Sets the edition agent in a waiting state until an expected
  * event occurs.
  * &lt;br&gt;The notifier must send the notification to the command selector of the editor
  * where the command has been started.
  * @param iNotifier
  *   The notifier.
  *   &lt;br&gt;&lt;b&gt;Legal values&lt;/b&gt;: The notifier may be NULL: the reception of the
  *   notification is sufficient to trigger the edition whatever the notifier. 
  * @param iNotif
  *   The notification address.
  *   The agent checks whether the received notifications belong to the
  *   same class as the &lt;tt&gt;iNotif&lt;/tt&gt; notification. So, only the 
  *   notification class matters. 
  *   &lt;br&gt;&lt;b&gt;Legal values&lt;/b&gt;: It can be NULL: any notification sent by the
  *   &lt;tt&gt;iNotifier&lt;/tt&gt; notifier values the agent. 
  * @return 
  *   &lt;dl&gt;
  *   &lt;dt&gt; &lt;tt&gt;S_OK&lt;/tt&gt;    &lt;dd&gt; The triggering condition is set
  *   &lt;dt&gt; &lt;tt&gt;E_FAIL&lt;/tt&gt;  &lt;dd&gt; &lt;tt&gt;iNotifier&lt;/tt&gt; and &lt;tt&gt;iNotif&lt;/tt&gt; are both NULL
  *   &lt;/dl&gt;   
  * @see SetFirstStateMessage
  */
  HRESULT SetEditTrigger (CATCommand * iNotifier, CATNotification * iNotif);
  
  /**
  * @nodoc
  * Specifies a user interaction expected by the agent before triggering the edition.
  * &lt;br&gt;&lt;b&gt;Role&lt;/b&gt;: Sets the edition agent in a waiting state until an expected
  * event occurs.
  * &lt;br&gt;The notifier must send the notification to the command selector of the editor
  * where the command has been started.
  * @param iNotifier
  *   The notifier.
  *   &lt;br&gt;&lt;b&gt;Legal values&lt;/b&gt;: The notifier may be NULL: the reception of the
  *   notification is sufficient to trigger the edition whatever the notifier. 
  * @param iNotifClass
  *   The notification class.
  *   &lt;br&gt;&lt;b&gt;Legal values&lt;/b&gt;: It can be NULL: any notification sent by the
  *   &lt;tt&gt;iNotifier&lt;/tt&gt; notifier values the agent. 
  * @return 
  *   &lt;dl&gt;
  *   &lt;dt&gt; &lt;tt&gt;S_OK&lt;/tt&gt;    &lt;dd&gt; The triggering condition is set
  *   &lt;dt&gt; &lt;tt&gt;E_FAIL&lt;/tt&gt;  &lt;dd&gt; &lt;tt&gt;iNotifier&lt;/tt&gt; and &lt;tt&gt;iNotifClass&lt;/tt&gt; are both NULL
  *   &lt;/dl&gt;   
  * @see SetFirstStateMessage
  */
  HRESULT SetEditTrigger (CATCommand * iNotifier, const char * iNotifClass);
  
  /**
  * @nodoc
  * Sets the message associated with the waiting state.
  * &lt;br&gt;&lt;b&gt;Role&lt;/b&gt;: This method must be used in conjunction with the
  * @href #SetEditTrigger to define the message associated with the waiting state.
  * @param iMessage
  *   The message to prompt
  * @return 
  *   S_OK 
  */
  HRESULT SetFirstStateMessage (const CATUnicodeString &amp; iMessage);
  
private:
  
  // Initialize (called by C&#x27;tors)
  void Init ();
  
  // Build state command graph (called during activation)
  virtual void BuildGraph ();
  
  // (called by SetEditTrigger)
  HRESULT DoSetEditTrigger (CATCommand *, CATNotification *, const char *);

  // Gets or creates command set
  CATStackableCommandSet * GetCommandSet ();
  
  // Gets active object
  CATActiveObject * GetActiveObject ();
  
  // Calls the ElementProvider method to get the element to edit.
  CATPathElement * GetWorkingElement ();

  // Condition Methods
  CATBoolean TrueCondition (void *);
  CATBoolean ValueCondition (void *);
  // Action Methods
  CATBoolean EnterEditStateAction (void *);
  CATBoolean LeaveEditStateAction (void *);
  CATBoolean StackAction (void *);
  CATBoolean UnstackAction (void *);
  
  // Type of the element edited by the agent
  CATClassId        _type;
  
  // Path of the edited element
  CATPathElement  * _value;
  
  // Notifier and Notification triggering the edition
  CATCommand      * _editOnNotifier;
  CATNotification * _editOnNotification;
  CATString         _editOnNotifClassName;
  // Agent triggering the edition
  CATDialogAgent  * _editTriggerAgent;
  // Message associated with the waiting first state
  CATUnicodeString  _firstStateMessage;
  
  // Agent triggering the end of the edition
  CATDialogAgent  * _editExitAgent;
  
  // The top level command&#x27;s ui to desactivate during the edition
  CATDialog       * _panel;
  
  // The client method used to get the element to edit
  ElementProvider   _elementProviderMethod;
  CATBaseUnknown  * _elementProvider;
  
  // The favorite workbench when ui-activating the provided path element
  CATString         _workbench;
  
  // The allowed stacked commands during edition
  CATStackableCommandSet * _commandSet;
  
  // NOT implemented, only declared to prevent unexpected call to default ctors created by the compiler
  CATEditAgent ();
  CATEditAgent (const CATEditAgent &amp;);
  CATEditAgent &amp; operator= (const CATEditAgent &amp;);
  
};

#endif//__CATEditAgent_h
</div>
    
    <div class="navigation">
        <div><a href="CATDlgEngUtility.html">‚Üê ‰∏ä‰∏ÄÈ°µ: CATDlgEngUtility.h</a></div>
        <div><a href="CATICmdSwitchAgent.html">‰∏ã‰∏ÄÈ°µ: CATICmdSwitchAgent.h ‚Üí</a></div>
    </div>
</body>
</html>