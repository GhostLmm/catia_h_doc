<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VPMServices/PublicInterfaces/CATVpmInfo.h</title>
    <style>
        body {
            font-family: 'Consolas', 'Monaco', monospace;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .header {
            background-color: #2c3e50;
            color: white;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        .navigation {
            display: flex;
            justify-content: space-between;
            margin: 15px 0;
            padding: 10px;
            background-color: #ecf0f1;
            border-radius: 5px;
        }
        .navigation a {
            color: #2980b9;
            text-decoration: none;
            padding: 5px 10px;
            background-color: white;
            border-radius: 3px;
            border: 1px solid #bdc3c7;
        }
        .navigation a:hover {
            background-color: #3498db;
            color: white;
        }
        .content {
            background-color: white;
            padding: 20px;
            border-radius: 5px;
            border: 1px solid #bdc3c7;
            white-space: pre-wrap;
            font-size: 14px;
            line-height: 1.4;
            overflow-x: auto;
        }
        .back-to-index {
            text-align: center;
            margin: 15px 0;
        }
        .back-to-index a {
            color: #27ae60;
            text-decoration: none;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>VPMServices/PublicInterfaces/CATVpmInfo.h</h1>
    </div>
    
    <div class="navigation">
        <div><a href="CATSchemaMacro.html">‚Üê ‰∏ä‰∏ÄÈ°µ: CATSchemaMacro.h</a></div>
        <div><a href="CATVpmTrace.html">‰∏ã‰∏ÄÈ°µ: CATVpmTrace.h ‚Üí</a></div>
    </div>
    
    <div class="back-to-index">
        <a href="index.html">üìÅ ËøîÂõûÁõÆÂΩï</a>
    </div>
    
    <div class="content">// COPYRIGHT DASSAULT SYSTEMES 1998
//=============================================================================
//
// VPM error management
//
//	Provides :
//	- HRESULT for VPM generation macros (compatible with HRESULT for OLE APIs)
//	- CATVpmInfo class, to handle additional information in case of
//	    warning, information, etc
//=============================================================================
// Usage Notes:
//	
//=============================================================================
// Avr 98   Creation                                   J.Poitreau
//============================================================================
/**
* @CAA2Level L1
* @CAA2Usage U1
*/

#ifndef _CATVpmInfo_H_
#define _CATVpmInfo_H_

#include &quot;ENOCheckProject.h&quot;
#include &quot;VX0TOOLS.h&quot;
#include &quot;IUnknown.h&quot;                   // HRESULT, S_OK, definitions, etc
#include &quot;CATUnicodeString.h&quot;
#include &quot;CATListOfCATUnicodeString.h&quot;

//
// Modif du RM pour la compile en cxr4
// le 21 10 1999

#include &quot;CATLISTV_Clean.h&quot;
#define CATLISTV_Append
#define CATLISTV_RemovePosition

#include &quot;CATLISTV_Declare.h&quot;

// for CATListOfCATVpmInfo
#undef  CATLISTV_eqOP
#undef  CATLISTV_neOP


//============================================================================
//                            INFO / ERROR macros
//============================================================================
//  HRESULT Values are 32 bit values layed out as follows:
//
//   3 3 2 2 2 2 2 2 2 2 2 2 1 1 1 1 1 1 1 1 1 1
//   1 0 9 8 7 6 5 4 3 2 1 0 9 8 7 6 5 4 3 2 1 0 9 8 7 6 5 4 3 2 1 0
//  +---+-+-+-----------------------+-------------------------------+
//  |Sev|C|R|     Facility          |               Code            |
//  +---+-+-+-----------------------+-------------------------------+
//
//  where
//      Sev - is the severity code
//          00 - Success
//          01 - Informational
//          10 - Warning
//          11 - Error
//      C - is the Customer code flag
//      R - is a reserved bit
//      Facility - is the facility code
//      Code - is the facility&#x27;s status code
//============================================================================

#if defined (_WINERROR_) || defined(SEVERITY_ERROR)
# undef SEVERITY_SUCCESS
# undef SEVERITY_ERROR
# undef SUCCEEDED
# undef FAILED
# undef IS_ERROR
# undef HRESULT_CODE
# undef HRESULT_SEVERITY
# undef MAKE_HRESULT
#endif

//----------------------------------------------------------------------------
// (VPM) FACILITY codes (bits )
//    to be used with facility argument of the
//    MAKE_VPM_HRESULT(sev,facility,code) macro
//----------------------------------------------------------------------------
#ifndef FACILITY_VPM
# define FACILITY_VPM      0x0100
# define FACILITY_VINF  FACILITY_VPM|1
# define FACILITY_VPOS  FACILITY_VPM|2
# define FACILITY_VAFL  FACILITY_VPM|3
# define FACILITY_VBOM  FACILITY_VPM|4
# define FACILITY_VCFG  FACILITY_VPM|5
# define FACILITY_VXBM  FACILITY_VPM|6
# define FACILITY_VMFG  FACILITY_VPM|7
#endif

//----------------------------------------------------------------------------
// SEVERITY codes (bits 31-30 of HRESULT)
//----------------------------------------------------------------------------

# define SEVERITY_SUCCESS    0
# define SEVERITY_INFO       1
# define SEVERITY_WARNING    2
# define SEVERITY_ERROR      3

//----------------------------------------------------------------------------
// When HRESULT is used for BOOLEAN purpose (and not error),
//  S_OK    means TRUE
//  S_FALSE means FALSE
// Note that SUCCEEDED(S_FALSE) &gt;= 0 --&gt; function succeeded and returned FALSE
//----------------------------------------------------------------------------
#ifndef S_OK
# define S_OK                ((HRESULT)0x00000000L)
# define S_FALSE             ((HRESULT)0x00000001L)
#endif
#ifndef E_UNEXPECTED
# define E_UNEXPECTED        ((HRESULT)0x8000FFFFL)
# define E_NOTIMPL           ((HRESULT)0x80004001L)
# define E_INVALIDARG        ((HRESULT)0x80070057L)
# define E_NOINTERFACE       ((HRESULT)0x80004002L)
# define E_POINTER           ((HRESULT)0x80004003L)
# define E_HANDLE            ((HRESULT)0x80070006L)
# define E_ABORT             ((HRESULT)0x80004004L)
# define E_FAIL              ((HRESULT)0x80004005L)
#endif

//----------------------------------------------------------------------------
// HRESULT Macros redefinitions
//----------------------------------------------------------------------------

# define SUCCEEDED(Status) ((HRESULT)(Status) &gt;= 0)
# define FAILED(Status)    ((HRESULT)(Status)&lt;0)
# define IS_ERROR(Status)  ((ULONG)(Status) &gt;&gt; 31 == SEVERITY_ERROR)
# define HRESULT_CODE(hr)     ((hr) &amp; 0xFFFF)
# define HRESULT_SEVERITY(hr) (((hr) &gt;&gt; 30) &amp; 0x3)

//----------------------------------------------------------------------------
// VPM HRESULT Macros definitions
// 1. _VPM_RESULT_(sev,fac,code)      to define a VPM HRESULT code
// 2. _VPM_INFO_(info_var,file,tag)   to fill info_var (CATVpmInfo instance)
//                                    necessary informations
//----------------------------------------------------------------------------
# define _VPM_HRESULT_(sev,fac,code) \
    ((HRESULT) (((ULONG)(sev)&lt;&lt;30) | ((ULONG)(fac)&lt;&lt;16) | ((ULONG)(code))) )

# define VPM_INFO(info,file,tag,hr) info.Init(file,tag,hr,__FILE__,__LINE__)

//============================================================================
//                            CATListOfCATVpmInfo class
//============================================================================

// exporting module
class ExportedByVX0TOOLS CATVpmInfo;
#undef  CATCOLLEC_ExportedBy
#define CATCOLLEC_ExportedBy    ExportedByVX0TOOLS
CATLISTV_DECLARE(CATVpmInfo)
typedef CATLISTV(CATVpmInfo) CATListOfCATVpmInfo;

//============================================================================
//                            CATVpmInfo class
//============================================================================
class ExportedByVX0TOOLS CATVpmInfo
{
public:
/** Constructor
*/
    CATVpmInfo();

  /**
   * @nodoc
   * New constructor used when demarshalling a login session. This is not for general use: use the default constructor instead.
   * Use of this is restricted to DS code, and more specifically to VPMServicesSDM/ENOVTransactionCtxt.m .
   */
  CATVpmInfo(int                               severity,
             HRESULT                           hresult,
             int                               line,
             const CATUnicodeString&amp;           file,
             const CATUnicodeString&amp;           msg,
             const CATUnicodeString&amp;           catalog,
             const CATUnicodeString&amp;           msg_key,
             const CATListOfCATUnicodeString&amp;  msg_params);
  
/** @nodoc */
    CATVpmInfo(const CATVpmInfo &amp;info);

/** @nodoc */
    ~CATVpmInfo();

/** @nodoc */
    void operator = (const CATVpmInfo &amp;info);

// 1 - Info initialisation methods
// -------------------------------

	// Initializing necessary info to build associated message
	// (Init() is used by MAKE_VPM_INFO). You can use :

/** @nodoc */
    void Init(const char *ctlg, const char *tag,
	          HRESULT     code = S_OK,
	          const char *file = &quot;&quot;,
	          int         line = 0);

	// Initializing message without using resource file + tag

/**
*   Initializing message with the appropriate return code, name of involved file and line.
*   @param iRawMsg
*   The message to put in the CATVpmInfo.
*   @param code
*   The return code.
*   @param file
*   The name of the involved file
*   @param line
*   Line number of the error.
*   @return
*   None. 
*/
    void Init(const CATUnicodeString &amp;iRawMsg,
	          HRESULT     code = S_OK,
	          const char *file = &quot;&quot;,
	          int         line = 0);

    // Message parameters valuation
/** @nodoc */
    void Add(const char    iParam);       // 1-byte  integer

/** @nodoc */
    void Add(const int     iParam);       // 4-bytes integer

/** @nodoc */
    void Add(const long    iParam);       // 4-bytes integer

/** @nodoc */
    void Add(const double  iParam);

/** @nodoc */
    void Add(const char   *iParam);

/** @nodoc */
    void Add(const CATUnicodeString &amp;iParam);

/** @nodoc */
    CATVpmInfo &amp;operator &lt;&lt;(const char    iParam);       // 1-byte  integer

/** @nodoc */
    CATVpmInfo &amp;operator &lt;&lt;(const int     iParam);       // 4-bytes integer

/** @nodoc */
    CATVpmInfo &amp;operator &lt;&lt;(const long    iParam);       // 4-bytes integer

/** @nodoc */
    CATVpmInfo &amp;operator &lt;&lt;(const double  iParam);

/** @nodoc */
    CATVpmInfo &amp;operator &lt;&lt;(const char   *iParam);

/** @nodoc */
    CATVpmInfo &amp;operator &lt;&lt;(const CATUnicodeString &amp;iParam);

	// Set HRESULT code
/** @nodoc */
   	void SetResult(HRESULT code);

	// Set source program information:
	// - source file name (you can use __FILE__ compiler defined macro)
	// - source line      (you can use __LINE__ compiler defined macro)
/** @nodoc */
	void SetSource(const char *file, int line);

	// Once initialized (with parameters, if any),
	// CATVpmInfo can be pushed into Infos&#x27; stack

/**
*   Once initialized, push the CATVpmInfo into Infos&#x27; stack.
*   @return
*   None. 
*/
	void Push();

// 2a - Retrieve information on a CATVpmInfo instance
// --------------------------------------------------

	// Returning informations about :

/** @nodoc */
	int              GetSeverity();       // HRESULT severity code (on 2-bits)

/** @nodoc */
	HRESULT          GetResult();         // HRESULT (32 bits)

/** @nodoc */
	CATUnicodeString GetMessage();        // associated NLS message

/** @nodoc */
	CATUnicodeString GetKey();            // Tag the NLS message

/** @nodoc */
	HRESULT          GetSource(CATUnicodeString &amp;oFile, int &amp;oLine);

// 2b - Retrieve CATVpmInfo instance(s) from infos&#x27; stack
// ------------------------------------------------------

	// Get Stack Size
/** @nodoc */
	static int        Size();
	// Get i-th CATVpmInfo element from the stack (without pop)

/** @nodoc */
	static HRESULT    GetInfo(CATVpmInfo &amp;info, int nIndex=-1);
	// Pop first element from the stack (last created element)
	// Stack size is decremented!

/** @nodoc */
	static HRESULT    Pop(CATVpmInfo &amp;info);
	// Empty stack

/** @nodoc */
	static void       Empty();

private:
	// reseting data in CATVpmInfo to reuse it for another info init ...
	void              Reset();

	// CATVpmInfo data
	// - code
	int                        _severity;
	HRESULT                    _hresult;
	// - source information
	int                        _line;
	CATUnicodeString           _file;
	// - message
	// - a) built message
	CATUnicodeString           _msg;
	// - b) catalog + tag + parameters
	CATUnicodeString           _catalog;
	CATUnicodeString           _msg_key;
	CATListOfCATUnicodeString  _msg_params;


  // JNI 6/6/2
  // new mode: multiple stacks of infos, each one kept inside the loginsession,
  // at user switch time we reset the global pointer to the &#x27;current&#x27; stack. Note that this
  // still is not reentrant.
  // Note that we use a list to implement the stack: the top of the stack is the tail of the list.
  static CATListOfCATVpmInfo *_current_stack;
  
  public:
  /**
   * @nodoc
   * This is used to extract the contents of an CATVpmInfo stack item, in order to serialize it,
   * the final goal is being able to transport it into another ENOVIA LCA server process.
   */
  void extract(int                        &amp;severity,
               HRESULT                    &amp;hresult,
               int                        &amp;line,
               CATUnicodeString           &amp;file,
               CATUnicodeString           &amp;msg,
               CATUnicodeString           &amp;catalog,
               CATUnicodeString           &amp;msg_key,
               CATListOfCATUnicodeString  &amp;msg_params);
  
#ifdef ENOVIA_MULTI_USER
  /**
   * @nodoc
   * This is not meant to be manipulated explicitly by modelers/applications, this is only
   * for the private use of the infrastructure (VPMPersistency) code, to reset the global
   * pointer for the &#x27;current&#x27; stack of infos when switching users.
   */
  static CATListOfCATVpmInfo *set_current_info_stack(CATListOfCATVpmInfo *);
  
//    // old working mode, only one stacks of infos. this variable is not used in enovia_multi_user mode.
//  	// Stack of CATVpmInfo&#x27;s
//  	static CATListOfCATVpmInfo _stack;
  
private:
  /**
   * @nodoc
   * This is used in conjunction with set_current_info_stack to allow
   * multiple errors stacks when in multi-user mode.
   */
  static CATListOfCATVpmInfo&amp; real_stack();
#endif
};

#endif // _CATVpmInfo_H_
</div>
    
    <div class="navigation">
        <div><a href="CATSchemaMacro.html">‚Üê ‰∏ä‰∏ÄÈ°µ: CATSchemaMacro.h</a></div>
        <div><a href="CATVpmTrace.html">‰∏ã‰∏ÄÈ°µ: CATVpmTrace.h ‚Üí</a></div>
    </div>
</body>
</html>