<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VPMInterfaces/PublicInterfaces/ENOVEventFireMacro.h</title>
    <style>
        body {
            font-family: 'Consolas', 'Monaco', monospace;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .header {
            background-color: #2c3e50;
            color: white;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        .navigation {
            display: flex;
            justify-content: space-between;
            margin: 15px 0;
            padding: 10px;
            background-color: #ecf0f1;
            border-radius: 5px;
        }
        .navigation a {
            color: #2980b9;
            text-decoration: none;
            padding: 5px 10px;
            background-color: white;
            border-radius: 3px;
            border: 1px solid #bdc3c7;
        }
        .navigation a:hover {
            background-color: #3498db;
            color: white;
        }
        .content {
            background-color: white;
            padding: 20px;
            border-radius: 5px;
            border: 1px solid #bdc3c7;
            white-space: pre-wrap;
            font-size: 14px;
            line-height: 1.4;
            overflow-x: auto;
        }
        .back-to-index {
            text-align: center;
            margin: 15px 0;
        }
        .back-to-index a {
            color: #27ae60;
            text-decoration: none;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>VPMInterfaces/PublicInterfaces/ENOVEventFireMacro.h</h1>
    </div>
    
    <div class="navigation">
        <div><a href="ENOVDataEventMacro.html">‚Üê ‰∏ä‰∏ÄÈ°µ: ENOVDataEventMacro.h</a></div>
        <div><a href="ENOVGenericLink.html">‰∏ã‰∏ÄÈ°µ: ENOVGenericLink.h ‚Üí</a></div>
    </div>
    
    <div class="back-to-index">
        <a href="index.html">üìÅ ËøîÂõûÁõÆÂΩï</a>
    </div>
    
    <div class="content">#ifndef ENOVEventFireMacro_H_
#define ENOVEventFireMacro_H_


/**
 * @CAA2Level L1
 * @CAA2Usage U1
 */

/**
 * MACRO EVENT_FIRE : to be used for emitting events. &lt;br&gt;
 *                    
 * &lt;b&gt;Role&lt;/b&gt;: By inserting this macro at the beginning and/or at the end of the method, a class is able to raise events.&lt;br&gt;
 *              clients which subscribed will be called back.               
 * @see ENOVIEvent
 */


//======================================================================== 
// ENOVIA_VPM (c) Copyright Dassault Systemes 1999
// -------------------------------------------------------------
// Responsable: AHC
// --------------------------------------------------------------
// Macro: ENOVEventFireMacro.h
// --------------------------------------------------------------
// Historic:
// Creation : 99/08/12 &gt; AHC
// --------------------------------------------------------------
// Comment:
//        
//    This macro manages the event model based on the Windows Connection model   
//    The behavior has been structured on four steps:
//
//    1- Event Creation and DataEvent initialization 
//    2- Checking subscriber 
//    3- Fire Event on an object and on an object type ( Early, Late ) 
//    4- Notify Management ( Early, Late ) 
//
// -&gt; argument: CONSTANT           &gt;&gt; Event type
// -&gt; argument: CONSTANT           &gt;&gt; Name of the connectable interface 
// -&gt; argument: CONSTANT           &gt;&gt; Raise event mode 
// -&gt; argument: ENOVIStream_var    &gt;&gt; outputStream related  to event 
// -&gt; argument: int                &gt;&gt; return code 
//
// exemple:
// 
// ENOVIStream_var oStream ;
// HRESULT ioRc ;
// EventFire(ChangeStatus,Action,ENOVIActionEvent,EvtFireStandard,oStream,ioRc); 
//
//======================================================================== 
//
// Include
//



#include &quot;VPMSession.h&quot;
#include &quot;ENOVIEventManager.h&quot;

#include &quot;ENOVIEvent.h&quot;
#include &quot;ENOVIStream.h&quot;
#include &quot;CATLISTPIUnknown.h&quot;
#include &quot;ENOVEventController.h&quot;
//        
    /**
     * @nodoc
     */  
#define EVTStandard(EVENT_ITF_NAME,EVENT_TYPE) \
                      TypMet MyPtrEvt = &amp;##EVENT_ITF_NAME::on##EVENT_TYPE

    /**
     * @nodoc
     */  
#define EVTBefore(EVENT_ITF_NAME,EVENT_TYPE) \
                      TypMet MyPtrEvt = &amp;##EVENT_ITF_NAME::on##Before##EVENT_TYPE

    /**
     * @nodoc
     */  
#define EVTAfter(EVENT_ITF_NAME,EVENT_TYPE) \
                      TypMet MyPtrEvt = &amp;##EVENT_ITF_NAME::on##After##EVENT_TYPE

    /**
     * @nodoc
     */  
#define EVTCONTROLBefore(EVENT_TYPE) \
  ENOVEventController EvtCtrlBefore(#EVENT_TYPE)
    /**
     * @nodoc
     */  
#define EVTCONTROLAfter(EVENT_TYPE) \
  ENOVEventController EvtCtrlAfter(#EVENT_TYPE)
    /**
     * @nodoc
     */  
#define EVTCONTROLStandard(EVENT_TYPE) \
  ENOVEventController EvtCtrlBefore(#EVENT_TYPE)

                                
    /**
     * Macro to raise events in object methods
     * @param EVENT_TYPE 
	 *        the Event name : must be written as a symbol, not a string
     * @param EVENT_ITF_NAME
	 *        The associated callback interface, clients can subscribe with.
	 *        Must be written as a symbol, not a string
     * @param EVT_FIRE_MOD
	 *        The step of the event ; must be &lt;br&gt;
	 *        Before for the macro inserted at the beginning of the method
	 *        After  for the macro inserted at the end       of the method
     * @param oStream
	 *        The client stream returned after the subscribers are called back.&lt;br&gt;
	 *        Must be null if no client stream  was declared in the .event file related with the event.
     * @param ioRc
	 *        code returned after subscribers were called. if E_ACCESSDENIED, the method is vetoed.
     */  
#define EVENT_FIRE(EVENT_TYPE,EVENT_ITF_NAME,EVT_FIRE_MOD,oStream,ioRc)  \
  EVTCONTROL##EVT_FIRE_MOD(#EVENT_TYPE) ;             \
{                                                     \
  HRESULT Ret= S_OK ;                                                    \
  typedef HRESULT (##EVENT_ITF_NAME::*TypMet)(const ENOVIEvent_var&amp; evt,HRESULT&amp; ioRc);  \
  EVT##EVT_FIRE_MOD(EVENT_ITF_NAME,EVENT_TYPE);                       \
  TypMet MyPtrEvtKo = &amp;##EVENT_ITF_NAME::onKo         ;               \
  ENOVIEventManager_var  EvtMng ;                                     \
  VPMSession::OpenSession()-&gt;get_ENOVEventManager(EvtMng) ;           \
  IUnknown* TmpPtr = (IUnknown*) this  ;                              \
  Ret = EvtMng-&gt;EventFire(#EVENT_TYPE,#EVT_FIRE_MOD,IID_##EVENT_ITF_NAME,TmpPtr,         \
                          (BaseTypMet)MyPtrEvt,(BaseTypMet)MyPtrEvtKo,oStream,ioRc);    \
  {if(strcmp(#EVT_FIRE_MOD,&quot;Before&quot;)==0) {                    \
      EvtCtrlBefore.SetPertinentFlag(TRUE);                 \
      EvtCtrlBefore.SetState(ENOVIEvent::EventFireBefore);  \
     EvtCtrlBefore.SetStepStatus(ioRc);                     \
   }                                                        \
  else if (strcmp(#EVT_FIRE_MOD,&quot;After&quot;)==0)                  \
   {                                                        \
      EvtCtrlBefore.SetPertinentFlag(TRUE);                 \
      EvtCtrlBefore.SetState(ENOVIEvent::EventFireAfter);   \
      EvtCtrlBefore.SetStepStatus(ioRc);                    \
   }							    \
  else                                                      \
   {                                                        \
      EvtCtrlBefore.SetPertinentFlag(TRUE);                 \
      EvtCtrlBefore.SetState(ENOVIEvent::EventFireStandard);\
      EvtCtrlBefore.SetStepStatus(ioRc);                    \
   }}}							    \

    /**
     * Macro to raise events.
     * To be used in cases where the event method code is put outside the firing object implementation.
     * Implies that an appropriate object instance is valid in the scope of that code.
     * @param iObject
	 *        the object that actually fires the event
     * @param EVENT_TYPE 
	 *        the Event name : must be written as a symbol, not a string
     * @param EVENT_ITF_NAME
	 *        The associated callback interface, clients can subscribe with.
	 *        Must be written as a symbol, not a string
     * @param EVT_FIRE_MOD
	 *        The step of the event ; must be &lt;br&gt;
	 *        Before for the macro inserted at the beginning of the method
	 *        After  for the macro inserted at the end       of the method
     * @param oStream
	 *        The client stream returned after the subscribers are called back.&lt;br&gt;
	 *        Must be null if no client stream  was declared in the .event file related with the event.
     * @param ioRc
	 *        code returned after subscribers were called. if E_ACCESSDENIED, the method is vetoed.
     */  
#define OBJECT_EVENT_FIRE(iObject,EVENT_TYPE,EVENT_ITF_NAME,EVT_FIRE_MOD,oStream,ioRc)  \
EVTCONTROL##EVT_FIRE_MOD(#EVENT_TYPE);                      \
{                                                           \
 if((CATBaseUnknown*)iObject!=NULL)                         \
 {                                                          \
  HRESULT Ret = S_OK;                                       \
  typedef HRESULT (##EVENT_ITF_NAME::*TypMet)(const ENOVIEvent_var&amp; evt,HRESULT&amp; ioRc); \
  EVT##EVT_FIRE_MOD(EVENT_ITF_NAME,EVENT_TYPE);             \
  TypMet MyPtrEvtKo = &amp;##EVENT_ITF_NAME::onKo;              \
  ENOVIEventManager_var EvtMng;                             \
  VPMSession::OpenSession()-&gt;get_ENOVEventManager(EvtMng);  \
  IUnknown* TmpPtr = NULL;                                  \
  iObject-&gt;QueryInterface(IID_IUnknown,(void**)&amp;TmpPtr);    \
  Ret = EvtMng-&gt;EventFire(#EVENT_TYPE,#EVT_FIRE_MOD,IID_##EVENT_ITF_NAME,TmpPtr,        \
                          (BaseTypMet)MyPtrEvt,(BaseTypMet)MyPtrEvtKo,oStream,ioRc);    \
  TmpPtr-&gt;Release();                                        \
  {if(strcmp(#EVT_FIRE_MOD,&quot;Before&quot;)==0)                    \
   {                                                        \
      EvtCtrlBefore.SetPertinentFlag(TRUE);                 \
      EvtCtrlBefore.SetState(ENOVIEvent::EventFireBefore);  \
      EvtCtrlBefore.SetStepStatus(ioRc);                    \
   }                                                        \
  else if(strcmp(#EVT_FIRE_MOD,&quot;After&quot;)==0)                 \
   {                                                        \
      EvtCtrlBefore.SetPertinentFlag(TRUE);                 \
      EvtCtrlBefore.SetState(ENOVIEvent::EventFireAfter);   \
      EvtCtrlBefore.SetStepStatus(ioRc);                    \
   }							    \
  else                                                      \
   {                                                        \
      EvtCtrlBefore.SetPertinentFlag(TRUE);                 \
      EvtCtrlBefore.SetState(ENOVIEvent::EventFireStandard);\
      EvtCtrlBefore.SetStepStatus(ioRc);                    \
   }							    \
  }							    \
 }							    \
}							    \

#endif 
</div>
    
    <div class="navigation">
        <div><a href="ENOVDataEventMacro.html">‚Üê ‰∏ä‰∏ÄÈ°µ: ENOVDataEventMacro.h</a></div>
        <div><a href="ENOVGenericLink.html">‰∏ã‰∏ÄÈ°µ: ENOVGenericLink.h ‚Üí</a></div>
    </div>
</body>
</html>