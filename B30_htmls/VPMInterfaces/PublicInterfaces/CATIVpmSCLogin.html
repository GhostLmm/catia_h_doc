<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VPMInterfaces/PublicInterfaces/CATIVpmSCLogin.h</title>
    <style>
        body {
            font-family: 'Consolas', 'Monaco', monospace;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .header {
            background-color: #2c3e50;
            color: white;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        .navigation {
            display: flex;
            justify-content: space-between;
            margin: 15px 0;
            padding: 10px;
            background-color: #ecf0f1;
            border-radius: 5px;
        }
        .navigation a {
            color: #2980b9;
            text-decoration: none;
            padding: 5px 10px;
            background-color: white;
            border-radius: 3px;
            border: 1px solid #bdc3c7;
        }
        .navigation a:hover {
            background-color: #3498db;
            color: white;
        }
        .content {
            background-color: white;
            padding: 20px;
            border-radius: 5px;
            border: 1px solid #bdc3c7;
            white-space: pre-wrap;
            font-size: 14px;
            line-height: 1.4;
            overflow-x: auto;
        }
        .back-to-index {
            text-align: center;
            margin: 15px 0;
        }
        .back-to-index a {
            color: #27ae60;
            text-decoration: none;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>VPMInterfaces/PublicInterfaces/CATIVpmSCLogin.h</h1>
    </div>
    
    <div class="navigation">
        <div><a href="CATIVpmQuery.html">‚Üê ‰∏ä‰∏ÄÈ°µ: CATIVpmQuery.h</a></div>
        <div><a href="CATIVpmServices.html">‰∏ã‰∏ÄÈ°µ: CATIVpmServices.h ‚Üí</a></div>
    </div>
    
    <div class="back-to-index">
        <a href="index.html">üìÅ ËøîÂõûÁõÆÂΩï</a>
    </div>
    
    <div class="content">// COPYRIGHT DASSAULT SYSTEMES 1997
//=============================================================================
//
// CATIVpmSCLogin:
//  &lt;b&gt;Security/Role&lt;/b&gt; Manager protected interface.
//  This interface provides basic methods to be used by login facility
//  (autologin or login panel, for example)
//
//=============================================================================
// Nov 97  J.Poitreau
//=============================================================================
/**
 * @CAA2Level L1
 * @CAA2Usage U3
**/

#ifndef _CATIVpmSCLogin_H_
#define _CATIVpmSCLogin_H_
//
#include &quot;CATBaseUnknown.h&quot;
#include &quot;CORBAAnyDef.h&quot;
#ifdef CATIAV5R17
#include &quot;CATListOfCATUnicodeString.h&quot;
#endif
#include &quot;CATIVpmPEPerson.h&quot;
#include &quot;CATIVpmPERole.h&quot;
#include &quot;CATIVpmPEOrganization.h&quot;
#include &quot;GUIDVPMInterfaces.h&quot;

/**
 * Defines Security role choice policy during login.
 * @param VPMLoginDEFAULT
 *   Takes the last role, or the first role valid if last role is not any
 *   more effective.
 * @param VPMLoginFIRST_FOUND
 *   Takes the first valid role from roles list.
 * @param VPMLoginFIRST_ADMIN
 *   Takes the first valid VPMADMIN role.
 * @param VPMLoginEXACT_ROLE
 *   Takes the role which name is given in parameter (see &lt;a href=CATIVpmSCLogin.htm#Login&gt;Login&lt;/a&gt; method).
 * @param VPMLoginALL_ROLES
 *   Not yet used.
 * @param VPMLoginEXACT_ROLES
 *   Not yet used.
**/
enum VPMLoginPolicy {
  VPMLoginDEFAULT = 0,
  VPMLoginFIRST_FOUND,
  VPMLoginFIRST_ADMIN,
  VPMLoginEXACT_ROLE,
  VPMLoginALL_ROLES,
  VPMLoginEXACT_ROLES
};

//
// -------------------------------
// Definition de la classe Interface
// -------------------------------
//                             

/** @nodoc */
#ifndef LOCAL_DEFINITION_FOR_IID
extern ExportedByGUIDVPMInterfaces IID IID_CATIVpmSCLogin;
#else
extern &quot;C&quot; const IID IID_CATIVpmSCLogin;
#endif

//-------------------------------------------------------------------

/**
 * CATIVpmSCLogin is one of the Security Management interfaces.
 * &lt;p&gt;
 * It is used to :
 * &lt;ol&gt;
 *  &lt;li&gt;authenticate user against People database.&lt;/li&gt;
 *  &lt;li&gt;initialize user&#x27;s Security profile (privileges, mask, licensing, etc).&lt;/li&gt;
 *  &lt;li&gt;&lt;/li&gt;
 * &lt;/ol&gt;
 * &lt;p&gt;
 * &lt;u&gt;Usage Notes:&lt;/u&gt;
 *   &lt;ul&gt;
 *    &lt;li&gt;use first &lt;tt&gt;Login(...)&lt;/tt&gt; to initialize login process
 *        and verify that given user is recognized into P&amp;amp.O database&lt;/li&gt;
 *    &lt;li&gt;then, use &lt;tt&gt;EndLogin()&lt;/tt&gt;&lt;/li&gt;
 *   &lt;/ul&gt;
 *
 * &lt;p&gt;&lt;a name=Example&gt;&lt;b&gt;Example&lt;/b&gt;&lt;/a&gt;:
 * &lt;table bgcolor=#fefedf&gt;&lt;tr&gt;&lt;td&gt;&lt;pre&gt;
 * &lt;font color=red&gt;// Suppose the exact role id (format: &lt;i&gt;name.org&lt;/i&gt;)is provided there:&lt;/font&gt;
 * CATUnicodeString sRoleId = &lt;i&gt;a role&lt;/i&gt;;
 * HRESULT hr = S_OK;
 * VPMSession * pSession = VPMSession::OpenSession();
 * if (pSession) {
 *    &lt;font color=red&gt;// Retrieves main factory&lt;/font&gt;
 *    CATIVpmFactoryManager_var vFM;
 *    if (pSession-&gt;getVPMObjectFactory(vFM)==S_OK &amp;&amp; !!vFM) {
 *       &lt;font color=red&gt;// Retrieves security login (extension of factory)&lt;/font&gt;
 *       CATIVpmSCLogin_var vLogin = vFM;
 *       if (!!vLogin) {
 *          &lt;font color=red&gt;// Login procedure&lt;/font&gt;
 *          CATUnicodeString          sNone;
 *          hr = vLogin-&gt;Login(sNone, sNone,
 *                             &lt;a href=VPMLoginPolicy.htm&gt;VPMLoginEXACT_ROLE&lt;/a&gt;, sRoleId);
 *          if (FAILED(hr)) {
 *            &lt;i&gt;aborting session...&lt;/i&gt;
 *          }
 *       }
 *    }
 * }&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
 *
 * @see VPMSession, CATIVpmFactoryManager
 */
// @see CATIVpmSCManager
// @see CATIVpmSCAdministration
class ExportedByGUIDVPMInterfaces CATIVpmSCLogin : public CATBaseUnknown   
{
	CATDeclareInterface;
	//
public:
/**
 * Returns database(s) authentication mode.
 * &lt;p&gt;When database is authenticated (also named SERVER mode), User and
 * Password must be used while connecting to the database,
 * unless the database is using a &lt;i&gt;single connection user&lt;/i&gt;
 * (which is the default mode at installation).
 *
 * @return
 *    1 (true) when database is authenticated, 0 otherwise.
**/
    virtual int IsAuthenticated() = 0;
/**
 * @nodoc
 * Returns SSO (Single Sign On) activation mode.
 * When SSO is active, User and/or Password can be retrieve from
 * &lt;i&gt;credential&lt;/i&gt; to automatically authenticate user.
 * Program does not need to prompt for user and/or password.&lt;br&gt;
 * Notice that SSO has meanings when used with SERVER authentication mode.
 *
 * @return
 *    1 (true) when SSO is active, 0 otherwise.
 *
 * @see CATIVpmSCSingleSignOn
**/
    virtual int SingleSignOnIsActive() = 0;

/**
 * @nodoc
 * Set user and password (in &lt;b&gt;server&lt;/b&gt;authentication mode) to initialize
 * &quot;manual&quot; login procedure.
 *
 * @param iUser
 *        user name
 * @param iPwd
 *        user password
 * &lt;p&gt;
 *   In authentication mode :
 *   &lt;ol&gt;
 *    &lt;li&gt;&lt;u&gt;Server&lt;/u&gt;: sets the database user / password
 *    &lt;li&gt;&lt;u&gt;Server with single DB user&lt;/u&gt;: user and password are not used.&lt;br&gt;
 *    &lt;li&gt;&lt;u&gt;Client&lt;/u&gt;: user and password are not used.&lt;br&gt;
 *      System user is automatically taken.
 *   &lt;/ol&gt;
 *   This mode is given by CATIVpmSCManager::IsAuthenticated() method.
 * @return
 *     0 if ok &lt;br&gt;
 *     1 when no connection OR invalid user/password &lt;br&gt;
 *     2 when user is not a VPM person &lt;br&gt;
 *    -1 on other errors
 * &lt;p&gt;
 *   Note: if ok, you can retrieve associated &lt;b&gt;CATIVpmPEPerson&lt;/b&gt; using GetLoginUser()
 *
 * @see CATIVpmPEPerson
 * @see CATIVpmSCManager#IsAuthenticated()
**/
	virtual int SetLoginUserPassword(
					CATUnicodeString iUser,
					CATUnicodeString iPwd) = 0;

/**
 * @nodoc
 * Set the role associated to the login person during the session
 * @param iRole
 *        role name.&lt;br&gt;
 *        This role MUST be one of the logged in person&#x27;s roles.&lt;br&gt;
 *        Such a role can be retrieved using CATIVpmPEPerson::GetRoleList()
 *        (inherited from CATIVpmPEPeople::GetRoleList()).

 *
 * @see CATIVpmPEPeople#GetRoleList()
 * @see CATIVpmPERole
**/
	virtual HRESULT SetLoginRole(CATIVpmPERole_var iRole) = 0;

/**
 * @nodoc
 * Validates the login procedure.
 *
 * &lt;p&gt;EV5 Licensing will be validated there.
 * &lt;br&gt;Notice that login cannot be completed (and security correctly initialized) if
 * ONE of these steps failed (&lt;tt&gt;Login, EndLogin&lt;/tt&gt;).
 * &lt;p&gt;In such a case, ANY SECURITY CHECK WILL FAIL !
**/
	virtual int EndLogin() = 0;

/**
 * @nodoc
 * Performs first step of login procedure.
 * This method is equivalent to using:
 * &lt;ul&gt;
 *  &lt;li&gt;SetLoginUserPassword(u,p)
 *  &lt;li&gt;SetLoginRole(),
 * &lt;/ul&gt;
 * @param iUser
 *        user name
 * @param iPwd
 *        user password
 * &lt;p&gt;
 *   In authentication mode :
 *   &lt;ol&gt;
 *    &lt;li&gt;&lt;u&gt;Server&lt;/u&gt;: sets the database user / password
 *    &lt;li&gt;&lt;u&gt;Client&lt;/u&gt;: user and password are not used.&lt;br&gt;
 *      System user is automatically taken.
 *   &lt;/ol&gt;
 * @param iRoleChoicePolicy
 *        enable the role choice strategy.
 *        Available possibilities are given by enum &lt;a href=VPMLoginPolicy.htm&gt;VPMLoginPolicy&lt;/a&gt;
 *        &lt;ul&gt;
 *         &lt;li&gt;&lt;b&gt;VPMLoginDEFAULT&lt;/b&gt;: selects the last/current person&#x27;s role if available,
 *             the first found otherwise.
 *         &lt;li&gt;&lt;b&gt;VPMLoginFIRST_FOUND&lt;/b&gt;: selects the first person&#x27;s role.
 *         &lt;li&gt;&lt;b&gt;VPMLoginFIRST_ADMIN&lt;/b&gt;: selects the first person&#x27;s ADMIN role
 *         &lt;li&gt;&lt;b&gt;VPMLoginEXACT_ROLE&lt;/b&gt;: selects the person&#x27;s role, given by iRoleName
 *        &lt;/ul&gt;
 * @param iRoleName
 *        role name concatenated to its organization id (separated by a .(dot)).
 *        This argument must be specified with &lt;b&gt;VPMLoginEXACT_ROLE&lt;/b&gt; policy.
 * @param iProjectName
 *        OPTIONAL project name.
 * @param oCookie
 *        a &quot;token&quot; associated to that login.
 *        This cookie is not persistent, but that be given to Client application to
 *        let them use Login(iCookie) method.
 * @param oPerson
 *        selected VPM person
 * @param oRole
 *        selected VPM role
 * @param oRoleOrg
 *        selected VPM role&#x27;s organization
 * @param oManager
 *        the manager of the selected VPM organization
 *
 * @return
 *      HRESULT value. FAILED when login could not be completed.
 *
 * @see CATIVpmPEOrganization
 * @see CATIVpmPEPerson
 * @see CATIVpmPERole
**/
	virtual HRESULT Login(
			      CATUnicodeString           iUser,
			      CATUnicodeString           iPwd,
			      VPMLoginPolicy             iRoleChoicePolicy,
			      CATUnicodeString           iRoleName,
			      CATUnicodeString           iProjectName,
			      CORBAAny                  &amp;oCookie,
			      CATIVpmPEPerson_var       &amp;oPerson,
			      CATIVpmPERole_var         &amp;oRole,
			      CATIVpmPEOrganization_var &amp;oRoleOrg,
			      CATIVpmPEPerson_var       &amp;oManager
			      ) = 0;
/**
 * @nodoc
 * Performs first step of login procedure.
 * &lt;p&gt;See &lt;a href=#Example&gt;example&lt;/a&gt;.
 *
 * @param iUser
 *        user name.
 *        Not any more used.
 * @param iPwd
 *        user password.
 *        Not any more used.
 * @param iRoleChoicePolicy
 *        enable the role choice strategy.
 *        &lt;br&gt;Enumerated possibilities are : &lt;a href=VPMLoginPolicy.htm&gt;VPMLoginPolicy&lt;/a&gt;
 * @param iRoleName
 *        role name concatenated to its organization id (separated by a .(dot)).
 *        &lt;br&gt;This argument must be specified with &lt;b&gt;VPMLoginEXACT_ROLE&lt;/b&gt; policy.
 * @param oPerson
 *        selected VPM person
 * @param oRole
 *        selected VPM role
 * @param oRoleOrg
 *        selected VPM role&#x27;s organization
 * @param oManager
 *        the manager of the selected VPM organization
 *
 * @return
 *      HRESULT value. FAILED when login could not be completed.
 *
**/
// @see CATIVpmPEOrganization
// @see CATIVpmPEPerson
// @see CATIVpmPERole
	virtual HRESULT Login(
			      CATUnicodeString           iUser,
			      CATUnicodeString           iPwd,
			      VPMLoginPolicy             iRoleChoicePolicy,
			      CATUnicodeString           iRoleName,
			      CATIVpmPEPerson_var       &amp;oPerson,
			      CATIVpmPERole_var         &amp;oRole,
			      CATIVpmPEOrganization_var &amp;oRoleOrg,
			      CATIVpmPEPerson_var       &amp;oManager
			      ) = 0;
/**
 * Performs the complete login procedure.
 * &lt;p&gt;See &lt;a href=#Example&gt;example&lt;/a&gt;.
 *
 * @param iUser
 *        user name.
 *        Not any more used.
 * @param iPwd
 *        user password.
 *        Not any more used.
 * @param iRoleChoicePolicy
 *        enable the role choice strategy.
 *        &lt;br&gt;Enumerated possibilities are : &lt;a href=VPMLoginPolicy.htm&gt;VPMLoginPolicy&lt;/a&gt;
 * @param iRoleName
 *        role name concatenated to its organization id (separated by a .(dot)).
 *        &lt;br&gt;This argument must be specified with &lt;b&gt;VPMLoginEXACT_ROLE&lt;/b&gt; policy.
 *
 * @return
 *      HRESULT value. FAILED when login could not be completed.
 *
**/
	virtual HRESULT Login(
			      CATUnicodeString           iUser,
			      CATUnicodeString           iPwd,
			      VPMLoginPolicy             iRoleChoicePolicy,
			      CATUnicodeString           iRoleName
			      ) = 0;

/**
 * @nodoc
 * Retrieve processes granted by the privileges granted due to the login procedure.
 * Privileges list is initialized when EndLogin() or Login(...) methods succeed.
 *
 * @param oProcList
 *   the list of returned processes (CATIVpmSCProcess objects)
 *
 * @return
 *   a HRESULT value. If SUCEEDED, returns:&lt;br&gt;
 *   &lt;b&gt;S_OK&lt;/b&gt; when some granted processes exist,&lt;br&gt;
 *   &lt;b&gt;S_FALSE&lt;/b&gt; if there is none.
 *
 * @see CATIVpmSCProcess
 * @see CATIVpmSCPrivilege
**/
    virtual HRESULT GetGrantedLoginProcesses (CATLISTV(CATBaseUnknown_var) &amp;oProcList ) = 0;
/**
 * @nodoc
 * Reset all Login properties - usually called to reset the session.
**/
    virtual HRESULT ResetLogin ( ) = 0;
/**
 * Get login informations.
 *
 * @param oUserId
 *   the current user id
 * @param oCtxId
 *   the current context id (format: role.organization.project)
 * @param oCtxRoleId
 *   the role id of the current context
 * @param oCtxOrgId
 *   the organization id of the current context
 * @param oCtxProjectId
 *   the project id of the current context
**/
    virtual HRESULT GetLoginInfos(CATUnicodeString &amp;oUserId,
				  CATUnicodeString &amp;oCtxId,
				  CATUnicodeString &amp;oCtxRoleId,
				  CATUnicodeString &amp;oCtxOrgId,
				  CATUnicodeString &amp;oCtxProjectId) = 0;
#ifdef CATIAV5R17
/**
 * Set additionnal login parameters.
 *
 * @param iParameterNames
 *   the list of parameter names
 * @param iParameterValues
 *   the list os parameter values
 * @return
 *   S_OK    if succeeded,
 *   S_FALSE in case of error
**/
    virtual HRESULT SetLoginParameters(CATListOfCATUnicodeString &amp;iParameterNames,
				       CATListOfCATUnicodeString &amp;iParameterValues) = 0;
#endif
};



CATDeclareHandler(CATIVpmSCLogin,CATBaseUnknown);



#endif
</div>
    
    <div class="navigation">
        <div><a href="CATIVpmQuery.html">‚Üê ‰∏ä‰∏ÄÈ°µ: CATIVpmQuery.h</a></div>
        <div><a href="CATIVpmServices.html">‰∏ã‰∏ÄÈ°µ: CATIVpmServices.h ‚Üí</a></div>
    </div>
</body>
</html>